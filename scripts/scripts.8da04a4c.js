JSON.search=function(e,t){if(t.length<2||"."==t||".+"==t)return[{key:"",val:"",chain:e,inKey:!1}];performIndexSearch=function(e,t){if(idx="string"==typeof t?(t=t.toLowerCase(),e.toLowerCase().search(t)):e.search(t),-1==idx)return[];for(ocpy=e,_starts=[idx];-1!=idx&&(ocpy=ocpy.substr(idx+1),idx=ocpy.search(t),-1!=idx);)_starts.push(_starts[_starts.length-1]+idx+1);return _starts},oobj=e,keys=Object.keys(e),numKeys=Object.keys(e).length,numDivisions=4,keysPerDivision=numKeys/numDivisions,strings=[];for(var n=0;n<numDivisions;n++){obj={};for(var o=n*keysPerDivision;o<numKeys;o++)obj[keys[o]]=e[keys[o]];strings.push(JSON.stringify(obj))}e=JSON.stringify(e),segmentSize=e.length,numSegments=e.length/segmentSize,starts=[];for(n=0;n<numSegments;n++)starts=starts.concat(performIndexSearch(e.substr(starts+n*segmentSize,segmentSize),t));for(var n in keys=[],backtrack=function(e,t,n){return null==n&&(n=!1),strsub=e.substr(0,t),rquote=e.substr(t).search(/([0-9]|\{|\[|")\:?/),quote=strsub.split("").reverse().join("").search(/"[^\\]?/),n||":"!=e.substr(t).substr(rquote+1,1)?(strsub=strsub.split("").reverse().join(""),end=strsub.search(/([0-9]|\{|\[|")\:"/),-1==end?-1:(strsubsub=strsub.substr(end+3),newstart=strsubsub.search(/"[^\\]?/),key=strsub.substr(end+3,newstart),key=key.split("").reverse().join(""),num=e.substr(0,t-end).match(new RegExp('"'+key+'"',"g")),num=null==num?0:num.length-1,[key,num,t-end-newstart,t-end])):[e.substr(t-quote,quote+rquote),e.substr(0,t+rquote+1).match(new RegExp('"'+e.substr(t-quote,quote+rquote)+'"',"g")).length-1]},keysearch=function(i,s,e,t){return function(e,t,n,o){for(var r in null==n&&(n=[0,!1]),e={},t=0,val="",i){if(r==s&&n[0]==o)return obj={},obj[s]=i[r],[obj,[1,!0],obj[s]];if(r==s&&n[0]++,"object"==typeof i[r]&&null!=i[r]&&(t++,result=keysearch(i[r],s,o,n),n[0]=result[1][0],n[1]=result[1][1],found=n[1],found&&2<result.length&&(val=result[2]),result=result[0],found)){e[r]=result;break}}return 0==t?[[],n,val]:[e,n,val]}({},0,t,e)},starts)key=backtrack(e,starts[n]),parents=keysearch(oobj,key[0],key[1]),inKey=-1!=key[0].search(t),obj={key:key[0],val:parents[2],chain:parents[0],inKey:inKey},keys.push(obj);for(var n in merged={},keys)merged=(r=merged,i=keys[n].chain,function e(t,n){var o;for(o in n)n.hasOwnProperty(o)&&(t[o]||(t[o]=void 0),"string"==typeof n[o]||"number"==typeof n[o]||"boolean"==typeof n[o]?t[o]=n[o]:"object"==typeof n[o]&&(t[o]||(n.hasOwnProperty(o)&&Array.isArray(n[o])&&n[o].hasOwnProperty("length")&&void 0!==n[o].length?t[o]=[]:t[o]={}),e(t[o],n[o])))}(s=JSON.parse(JSON.stringify(r)),i),s);var r,i,s;return keys},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.diffsync=e()}}(function(){return function i(s,a,c){function l(n,e){if(!a[n]){if(!s[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(d)return d(n,!0);var o=new Error("Cannot find module '"+n+"'");throw o.code="MODULE_NOT_FOUND",o}var r=a[n]={exports:{}};s[n][0].call(r.exports,function(e){var t=s[n][1][e];return l(t||e)},r,r.exports,i,s,a,c)}return a[n].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({1:[function(e,t,n){function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function c(e){return"object"==typeof e&&null!==e}function l(e){return void 0===e}((t.exports=o).EventEmitter=o).prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},o.prototype.emit=function(e){var t,n,o,r,i,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(l(n=this._events[e]))return!1;if(a(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(o=arguments.length,r=new Array(o-1),i=1;i<o;i++)r[i-1]=arguments[i];n.apply(this,r)}else if(c(n)){for(o=arguments.length,r=new Array(o-1),i=1;i<o;i++)r[i-1]=arguments[i];for(o=(s=n.slice()).length,i=0;i<o;i++)s[i].apply(this,r)}return!0},o.prototype.on=o.prototype.addListener=function(e,t){var n;if(!a(t))throw TypeError("listener must be a function");this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?c(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,!c(this._events[e])||this._events[e].warned||(n=l(this._maxListeners)?o.defaultMaxListeners:this._maxListeners)&&0<n&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace());return this},o.prototype.once=function(e,t){if(!a(t))throw TypeError("listener must be a function");var n=!1;function o(){this.removeListener(e,o),n||(n=!0,t.apply(this,arguments))}return o.listener=t,this.on(e,o),this},o.prototype.removeListener=function(e,t){var n,o,r,i;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(n=this._events[e]).length,o=-1,n===t||a(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(c(n)){for(i=r;0<i--;)if(n[i]===t||n[i].listener&&n[i].listener===t){o=i;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},o.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(a(n=this._events[e]))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},o.prototype.listeners=function(e){return this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},o.listenerCount=function(e,t){return e._events&&e._events[t]?a(e._events[t])?1:e._events[t].length:0}},{}],2:[function(e,t,n){t.exports={Client:e("./src/client"),Server:e("./src/server"),COMMANDS:e("./src/commands"),InMemoryDataAdapter:e("./src/adapter")}},{"./src/adapter":43,"./src/client":44,"./src/commands":45,"./src/server":46}],3:[function(e,t,n){function o(){}var r=e("../pipe").Pipe;o.prototype.setResult=function(e){return this.result=e,this.hasResult=!0,this},o.prototype.exit=function(){return this.exiting=!0,this},o.prototype.switchTo=function(e,t){return"string"==typeof e||e instanceof r?this.nextPipe=e:(this.next=e,t&&(this.nextPipe=t)),this},o.prototype.push=function(e,t){return e.parent=this,void 0!==t&&(e.childName=t),e.root=this.root||this,e.options=e.options||this.options,this.children?(this.children[this.children.length-1].next=e,this.children.push(e)):(this.children=[e],this.nextAfterChildren=this.next||null,this.next=e),e.next=this},n.Context=o},{"../pipe":17}],4:[function(e,t,n){function o(e,t){this.left=e,this.right=t,this.pipe="diff"}var r=e("./context").Context;o.prototype=new r,n.DiffContext=o},{"./context":3}],5:[function(e,t,n){function o(e,t){this.left=e,this.delta=t,this.pipe="patch"}var r=e("./context").Context;o.prototype=new r,n.PatchContext=o},{"./context":3}],6:[function(e,t,n){function o(e){this.delta=e,this.pipe="reverse"}var r=e("./context").Context;o.prototype=new r,n.ReverseContext=o},{"./context":3}],7:[function(e,t,n){t.exports=function(e,t){var n;return"string"==typeof t&&(n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+\-])(\d{2}):(\d{2}))$/.exec(t))?new Date(Date.UTC(+n[1],n[2]-1,+n[3],+n[4],+n[5],+n[6],+(n[7]||0))):t}},{}],8:[function(e,t,n){function o(e){this.processor=new r(e),this.processor.pipe(new i("diff").append(d.collectChildrenDiffFilter,l.diffFilter,u.diffFilter,m.diffFilter,d.objectsDiffFilter,p.diffFilter).shouldHaveResult()),this.processor.pipe(new i("patch").append(d.collectChildrenPatchFilter,p.collectChildrenPatchFilter,l.patchFilter,m.patchFilter,d.patchFilter,p.patchFilter).shouldHaveResult()),this.processor.pipe(new i("reverse").append(d.collectChildrenReverseFilter,p.collectChildrenReverseFilter,l.reverseFilter,m.reverseFilter,d.reverseFilter,p.reverseFilter).shouldHaveResult())}var r=e("./processor").Processor,i=e("./pipe").Pipe,s=e("./contexts/diff").DiffContext,a=e("./contexts/patch").PatchContext,c=e("./contexts/reverse").ReverseContext,l=e("./filters/trivial"),d=e("./filters/nested"),p=e("./filters/arrays"),u=e("./filters/dates"),m=e("./filters/texts");o.prototype.options=function(){return this.processor.options.apply(this.processor,arguments)},o.prototype.diff=function(e,t){return this.processor.process(new s(e,t))},o.prototype.patch=function(e,t){return this.processor.process(new a(e,t))},o.prototype.reverse=function(e){return this.processor.process(new c(e))},o.prototype.unpatch=function(e,t){return this.patch(e,this.reverse(t))},n.DiffPatcher=o},{"./contexts/diff":4,"./contexts/patch":5,"./contexts/reverse":6,"./filters/arrays":10,"./filters/dates":11,"./filters/nested":13,"./filters/texts":14,"./filters/trivial":15,"./pipe":17,"./processor":18}],9:[function(e,t,n){n.isBrowser="undefined"!=typeof window},{}],10:[function(e,t,n){var _=e("../contexts/diff").DiffContext,g=e("../contexts/patch").PatchContext,o=e("../contexts/reverse").ReverseContext,j=e("./lcs"),c="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},P="function"==typeof Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=e.length,o=0;o<n;o++)if(e[o]===t)return o;return-1};function S(e,t,n,o,r){var i=e[n],s=t[o];if(i===s)return!0;if("object"!=typeof i||"object"!=typeof s)return!1;var a,c,l=r.objectHash;return l?("number"==typeof n?(r.hashCache1=r.hashCache1||[],void 0===(a=r.hashCache1[n])&&(r.hashCache1[n]=a=l(i,n))):a=l(i),void 0!==a&&("number"==typeof o?(r.hashCache2=r.hashCache2||[],void 0===(c=r.hashCache2[o])&&(r.hashCache2[o]=c=l(s,o))):c=l(s),void 0!==c&&a===c)):r.matchByPosition&&n===o}function r(e){if(e.leftIsArray){var t,n,o,r,i,s={objectHash:e.options&&e.options.objectHash,matchByPosition:e.options&&e.options.matchByPosition},a=0,c=0,l=e.left,d=e.right,p=l.length,u=d.length;for(0<p&&0<u&&!s.objectHash&&"boolean"!=typeof s.matchByPosition&&(s.matchByPosition=!function(e,t,n,o){for(var r=0;r<n;r++)for(var i=e[r],s=0;s<o;s++){if(i===t[s])return 1}}(l,d,p,u));a<p&&a<u&&S(l,d,a,a,s);)t=a,r=new _(e.left[t],e.right[t]),e.push(r,t),a++;for(;c+a<p&&c+a<u&&S(l,d,p-1-c,u-1-c,s);)n=p-1-c,o=u-1-c,r=new _(e.left[n],e.right[o]),e.push(r,o),c++;if(a+c!==p)if(a+c!==u){delete s.hashCache1,delete s.hashCache2;var m=l.slice(a,p-c),h=d.slice(a,u-c),g=j.get(m,h,S,s),f=[];for(i=i||{_t:"a"},t=a;t<p-c;t++)P(g.indices1,t-a)<0&&(i["_"+t]=[l[t],0,0],f.push(t));var v=!0;e.options&&e.options.arrays&&!1===e.options.arrays.detectMove&&(v=!1);var y=!1;e.options&&e.options.arrays&&e.options.arrays.includeValueOnMove&&(y=!0);var b=f.length;for(t=a;t<u-c;t++){var x=P(g.indices2,t-a);if(x<0){var w=!1;if(v&&0<b)for(var k=0;k<b;k++)if(S(m,h,(n=f[k])-a,t-a,s)){i["_"+n].splice(1,2,t,3),y||(i["_"+n][0]=""),o=t,r=new _(e.left[n],e.right[o]),e.push(r,o),f.splice(k,1),w=!0;break}w||(i[t]=[d[t]])}else n=g.indices1[x]+a,o=g.indices2[x]+a,r=new _(e.left[n],e.right[o]),e.push(r,o)}e.setResult(i).exit()}else{for(i=i||{_t:"a"},t=a;t<p-c;t++)i["_"+t]=[l[t],0,0];e.setResult(i).exit()}else{if(p===u)return void e.setResult(void 0).exit();for(i=i||{_t:"a"},t=a;t<u-c;t++)i[t]=[d[t]];e.setResult(i).exit()}}}function i(e){if(e.nested&&"a"===e.delta._t){var t,n,o=e.delta,r=e.left,i=[],s=[],a=[];for(t in o)if("_t"!==t)if("_"===t[0]){if(0!==o[t][2]&&3!==o[t][2])throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+o[t][2]);i.push(parseInt(t.slice(1),10))}else 1===o[t].length?s.push({index:parseInt(t,10),value:o[t][0]}):a.push({index:parseInt(t,10),delta:o[t]});for(t=(i=i.sort(f)).length-1;0<=t;t--){var c=o["_"+(n=i[t])],l=r.splice(n,1)[0];3===c[2]&&s.push({index:c[1],value:l})}var d=(s=s.sort(v("index"))).length;for(t=0;t<d;t++){var p=s[t];r.splice(p.index,0,p.value)}var u,m=a.length;if(0<m)for(t=0;t<m;t++){var h=a[t];u=new g(e.left[h.index],h.delta),e.push(u,h.index)}e.children?e.exit():e.setResult(e.left).exit()}}var f=function(e,t){return e-t},v=function(n){return function(e,t){return e[n]-t[n]}};i.filterName=r.filterName="arrays";function s(e){if(e&&e.children&&"a"===e.delta._t){for(var t,n=e.children.length,o=0;o<n;o++)t=e.children[o],e.left[t.childName]=t.result;e.setResult(e.left).exit()}}s.filterName="arraysCollectChildren";function a(e){if(e.nested){if("a"===e.delta._t){var t,n;for(t in e.delta)"_t"!==t&&(n=new o(e.delta[t]),e.push(n,t));e.exit()}}else 3===e.delta[2]&&(e.newName="_"+e.delta[1],e.setResult([e.delta[0],parseInt(e.childName.substr(1),10),3]).exit())}a.filterName="arrays";function l(e,t,n){if("string"==typeof t&&"_"===t[0])return parseInt(t.substr(1),10);if(c(n)&&0===n[2])return"_"+t;var o=+t;for(var r in e){var i=e[r];if(c(i))if(3===i[2]){var s=parseInt(r.substr(1),10),a=i[1];if(a===+t)return s;s<=o&&o<a?o++:o<=s&&a<o&&o--}else if(0===i[2]){parseInt(r.substr(1),10)<=o&&o++}else 1===i.length&&r<=o&&o--}return o}function d(e){if(e&&e.children&&"a"===e.delta._t){for(var t,n=e.children.length,o={_t:"a"},r=0;r<n;r++){var i=(t=e.children[r]).newName;void 0===i&&(i=l(e.delta,t.childName,t.result)),o[i]!==t.result&&(o[i]=t.result)}e.setResult(o).exit()}}d.filterName="arraysCollectChildren",n.diffFilter=r,n.patchFilter=i,n.collectChildrenPatchFilter=s,n.reverseFilter=a,n.collectChildrenReverseFilter=d},{"../contexts/diff":4,"../contexts/patch":5,"../contexts/reverse":6,"./lcs":12}],11:[function(e,t,n){function o(e){e.left instanceof Date?(!(e.right instanceof Date)||e.left.getTime()!==e.right.getTime()?e.setResult([e.left,e.right]):e.setResult(void 0),e.exit()):e.right instanceof Date&&e.setResult([e.left,e.right]).exit()}o.filterName="dates",n.diffFilter=o},{}],12:[function(e,t,n){function s(e,t,n,o){return e[n]===t[o]}var a=function(e,t,n,o,r,i){if(0===o||0===r)return{sequence:[],indices1:[],indices2:[]};if(e.match(t,n,o-1,r-1,i)){var s=a(e,t,n,o-1,r-1,i);return s.sequence.push(t[o-1]),s.indices1.push(o-1),s.indices2.push(r-1),s}return e[o][r-1]>e[o-1][r]?a(e,t,n,o,r-1,i):a(e,t,n,o-1,r,i)};n.get=function(e,t,n,o){var r=function(e,t,n,o){var r,i,s=e.length,a=t.length,c=[s+1];for(r=0;r<s+1;r++)for(c[r]=[a+1],i=0;i<a+1;i++)c[r][i]=0;for(c.match=n,r=1;r<s+1;r++)for(i=1;i<a+1;i++)n(e,t,r-1,i-1,o)?c[r][i]=c[r-1][i-1]+1:c[r][i]=Math.max(c[r-1][i],c[r][i-1]);return c}(e,t,n||s,o=o||{}),i=a(r,e,t,e.length,t.length,o);return"string"==typeof e&&"string"==typeof t&&(i.sequence=i.sequence.join("")),i}},{}],13:[function(e,t,n){function o(e){if(e&&e.children){for(var t,n=e.children.length,o=e.result,r=0;r<n;r++)void 0!==(t=e.children[r]).result&&((o=o||{})[t.childName]=t.result);o&&e.leftIsArray&&(o._t="a"),e.setResult(o).exit()}}var r=e("../contexts/diff").DiffContext,i=e("../contexts/patch").PatchContext,s=e("../contexts/reverse").ReverseContext;o.filterName="collectChildren";function a(e){if(!e.leftIsArray&&"object"===e.leftType){var t,n;for(t in e.left)n=new r(e.left[t],e.right[t]),e.push(n,t);for(t in e.right)void 0===e.left[t]&&(n=new r(void 0,e.right[t]),e.push(n,t));e.children&&0!==e.children.length?e.exit():e.setResult(void 0).exit()}}function c(e){if(e.nested&&!e.delta._t){var t,n;for(t in e.delta)n=new i(e.left[t],e.delta[t]),e.push(n,t);e.exit()}}c.filterName=a.filterName="objects";function l(e){if(e&&e.children&&!e.delta._t){for(var t,n=e.children.length,o=0;o<n;o++)t=e.children[o],e.left.hasOwnProperty(t.childName)&&void 0===t.result?delete e.left[t.childName]:e.left[t.childName]!==t.result&&(e.left[t.childName]=t.result);e.setResult(e.left).exit()}}l.filterName="collectChildren";function d(e){if(e.nested&&!e.delta._t){var t,n;for(t in e.delta)n=new s(e.delta[t]),e.push(n,t);e.exit()}}d.filterName="objects";function p(e){if(e&&e.children&&!e.delta._t){for(var t,n=e.children.length,o={},r=0;r<n;r++)o[(t=e.children[r]).childName]!==t.result&&(o[t.childName]=t.result);e.setResult(o).exit()}}p.filterName="collectChildren",n.collectChildrenDiffFilter=o,n.objectsDiffFilter=a,n.patchFilter=c,n.collectChildrenPatchFilter=l,n.reverseFilter=d,n.collectChildrenReverseFilter=p},{"../contexts/diff":4,"../contexts/patch":5,"../contexts/reverse":6}],14:[function(n,e,t){function o(){if(!a){var r;if("undefined"!=typeof diff_match_patch)r="function"==typeof diff_match_patch?new diff_match_patch:new diff_match_patch.diff_match_patch;else if("function"==typeof n)try{var e=n("../../public/external/diff_match_patch_uncompressed");r=new e.diff_match_patch}catch(e){r=null}if(!r){var t=new Error("text diff_match_patch library not found");throw t.diff_match_patch_not_found=!0,t}a={diff:function(e,t){return r.patch_toText(r.patch_make(e,t))},patch:function(e,t){for(var n=r.patch_apply(r.patch_fromText(t),e),o=0;o<n[1].length;o++){if(!n[1][o])new Error("text patch failed").textPatchFailed=!0}return n[0]}}}return a}function r(e){if("string"===e.leftType){var t=e.options&&e.options.textDiff&&e.options.textDiff.minLength||60;if(e.left.length<t||e.right.length<t)e.setResult([e.left,e.right]).exit();else{var n=o().diff;e.setResult([n(e.left,e.right),0,2]).exit()}}}function i(e){if(!e.nested&&2===e.delta[2]){var t=o().patch;e.setResult(t(e.left,e.delta[0])).exit()}}function s(e){e.nested||2===e.delta[2]&&e.setResult([function(e){var t,n,o,r,i,s=null,a=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;for(t=0,n=(o=e.split("\n")).length;t<n;t++){var c=(r=o[t]).slice(0,1);"@"===c?(s=a.exec(r),0,o[t]="@@ -"+s[3]+","+s[4]+" +"+s[1]+","+s[2]+" @@"):"+"===c?(o[t]="-"+o[t].slice(1),"+"===o[t-1].slice(0,1)&&(i=o[t],o[t]=o[t-1],o[t-1]=i)):"-"===c&&(o[t]="+"+o[t].slice(1))}return o.join("\n")}(e.delta[0]),0,2]).exit()}var a=null;s.filterName=i.filterName=r.filterName="texts",t.diffFilter=r,t.patchFilter=i,t.reverseFilter=s},{}],15:[function(e,t,n){function o(e){if(e.left!==e.right)if(void 0!==e.left)if(void 0!==e.right){if("function"==typeof e.left||"function"==typeof e.right)throw new Error("functions are not supported");e.leftType=null===e.left?"null":typeof e.left,e.rightType=null===e.right?"null":typeof e.right,e.leftType===e.rightType&&"boolean"!==e.leftType&&"number"!==e.leftType?("object"===e.leftType&&(e.leftIsArray=s(e.left)),"object"===e.rightType&&(e.rightIsArray=s(e.right)),e.leftIsArray===e.rightIsArray||e.setResult([e.left,e.right]).exit()):e.setResult([e.left,e.right]).exit()}else e.setResult([e.left,0,0]).exit();else{if("function"==typeof e.right)throw new Error("functions are not supported");e.setResult([e.right]).exit()}else e.setResult(void 0).exit()}function r(e){void 0!==e.delta?(e.nested=!s(e.delta),e.nested||(1!==e.delta.length?2!==e.delta.length?3!==e.delta.length||0!==e.delta[2]||e.setResult(void 0).exit():e.setResult(e.delta[1]).exit():e.setResult(e.delta[0]).exit())):e.setResult(e.left).exit()}function i(e){void 0!==e.delta?(e.nested=!s(e.delta),e.nested||(1!==e.delta.length?2!==e.delta.length?3!==e.delta.length||0!==e.delta[2]||e.setResult([e.delta[0]]).exit():e.setResult([e.delta[1],e.delta[0]]).exit():e.setResult([e.delta[0],0,0]).exit())):e.setResult(e.delta).exit()}var s="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array};i.filterName=r.filterName=o.filterName="trivial",n.diffFilter=o,n.patchFilter=r,n.reverseFilter=i},{}],16:[function(e,t,n){var o,r=e("./environment"),i=e("./diffpatcher").DiffPatcher;if(n.DiffPatcher=i,n.create=function(e){return new i(e)},n.dateReviver=e("./date-reviver"),n.diff=function(){return(o=o||new i).diff.apply(o,arguments)},n.patch=function(){return(o=o||new i).patch.apply(o,arguments)},n.unpatch=function(){return(o=o||new i).unpatch.apply(o,arguments)},n.reverse=function(){return(o=o||new i).reverse.apply(o,arguments)},r.isBrowser)n.homepage="{{package-homepage}}",n.version="{{package-version}}";else{var s=e("../package.json");n.homepage=s.homepage,n.version=s.version;var a=e("./formatters");n.formatters=a,n.console=a.console}},{"./date-reviver":7,"./diffpatcher":8,"./environment":9}],17:[function(e,t,n){function o(e){this.name=e,this.filters=[]}o.prototype.process=function(e){if(!this.processor)throw new Error("add this pipe to a processor before using it");for(var t=this.debug,n=this.filters.length,o=e,r=0;r<n;r++){var i=this.filters[r];if(t&&this.log("filter: "+i.filterName),i(o),"object"==typeof o&&o.exiting){o.exiting=!1;break}}!o.next&&this.resultCheck&&this.resultCheck(o)},o.prototype.log=function(e){console.log("[jsondiffpatch] "+this.name+" pipe, "+e)},o.prototype.append=function(){return this.filters.push.apply(this.filters,arguments),this},o.prototype.prepend=function(){return this.filters.unshift.apply(this.filters,arguments),this},o.prototype.indexOf=function(e){if(!e)throw new Error("a filter name is required");for(var t=0;t<this.filters.length;t++){if(this.filters[t].filterName===e)return t}throw new Error("filter not found: "+e)},o.prototype.list=function(){for(var e=[],t=0;t<this.filters.length;t++){var n=this.filters[t];e.push(n.filterName)}return e},o.prototype.after=function(e){var t=this.indexOf(e),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(t+1,0),Array.prototype.splice.apply(this.filters,n),this},o.prototype.before=function(e){var t=this.indexOf(e),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(t,0),Array.prototype.splice.apply(this.filters,n),this},o.prototype.clear=function(){return this.filters.length=0,this},o.prototype.shouldHaveResult=function(e){if(!1!==e){if(!this.resultCheck){var n=this;return this.resultCheck=function(e){if(!e.hasResult){console.log(e);var t=new Error(n.name+" failed");throw t.noResult=!0,t}},this}}else this.resultCheck=null},n.Pipe=o},{}],18:[function(e,t,n){function o(e){this.selfOptions=e,this.pipes={}}o.prototype.options=function(e){return e&&(this.selfOptions=e),this.selfOptions},o.prototype.pipe=function(e,t){if("string"==typeof e){if(void 0===t)return this.pipes[e];this.pipes[e]=t}if(e&&e.name){if((t=e).processor===this)return t;this.pipes[t.name]=t}return t.processor=this,t},o.prototype.process=function(e,t){var n=e;n.options=this.options();for(var o,r,i=t||e.pipe||"default";i;)void 0!==n.nextAfterChildren&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),"string"==typeof i&&(i=this.pipe(i)),i.process(n),o=i,i=null,(r=n)&&n.next&&(n=n.next,i=r.nextPipe||n.pipe||o);return n.hasResult?n.result:void 0},n.Processor=o},{}],19:[function(e,t,n){var o=e("lodash._baseassign"),r=e("lodash._createassigner"),l=e("lodash.keys");var i=r(function(e,t,n){return n?function(e,t,n){for(var o=-1,r=l(t),i=r.length;++o<i;){var s=r[o],a=e[s],c=n(a,t[s],s,e,t);(c==c?c===a:a!=a)&&(void 0!==a||s in e)||(e[s]=c)}return e}(e,t,n):o(e,t)});t.exports=i},{"lodash._baseassign":20,"lodash._createassigner":22,"lodash.keys":26}],20:[function(e,t,n){var o=e("lodash._basecopy"),r=e("lodash.keys");t.exports=function(e,t){return null==t?e:o(t,r(t),e)}},{"lodash._basecopy":21,"lodash.keys":26}],21:[function(e,t,n){t.exports=function(e,t,n){n=n||{};for(var o=-1,r=t.length;++o<r;){var i=t[o];n[i]=e[i]}return n}},{}],22:[function(e,t,n){var l=e("lodash._bindcallback"),d=e("lodash._isiterateecall"),o=e("lodash.restparam");t.exports=function(c){return o(function(e,t){var n=-1,o=null==e?0:t.length,r=2<o?t[o-2]:void 0,i=2<o?t[2]:void 0,s=1<o?t[o-1]:void 0;for("function"==typeof r?(r=l(r,s,5),o-=2):o-=(r="function"==typeof s?s:void 0)?1:0,i&&d(t[0],t[1],i)&&(r=o<3?void 0:r,o=1);++n<o;){var a=t[n];a&&c(e,a,r)}return e})}},{"lodash._bindcallback":23,"lodash._isiterateecall":24,"lodash.restparam":25}],23:[function(e,t,n){function o(e){return e}t.exports=function(i,s,e){if("function"!=typeof i)return o;if(void 0===s)return i;switch(e){case 1:return function(e){return i.call(s,e)};case 3:return function(e,t,n){return i.call(s,e,t,n)};case 4:return function(e,t,n,o){return i.call(s,e,t,n,o)};case 5:return function(e,t,n,o,r){return i.call(s,e,t,n,o,r)}}return function(){return i.apply(s,arguments)}}},{}],24:[function(e,t,n){var l=/^\d+$/,d=9007199254740991;var o,r=(o="length",function(e){return null==e?void 0:e[o]});function p(e){return null!=e&&("number"==typeof(t=r(e))&&-1<t&&t%1==0&&t<=d);var t}t.exports=function(e,t,n){if(r=typeof(o=n),!o||"object"!=r&&"function"!=r)return!1;var o,r,i,s,a=typeof t;if("number"==a?p(n)&&(i=t,s=n.length,i="number"==typeof i||l.test(i)?+i:-1,s=null==s?d:s,-1<i&&i%1==0&&i<s):"string"==a&&t in n){var c=n[t];return e==e?e===c:c!=c}return!1}},{}],25:[function(e,t,n){var a=Math.max;t.exports=function(i,s){if("function"!=typeof i)throw new TypeError("Expected a function");return s=a(void 0===s?i.length-1:+s||0,0),function(){for(var e=arguments,t=-1,n=a(e.length-s,0),o=Array(n);++t<n;)o[t]=e[s+t];switch(s){case 0:return i.call(this,o);case 1:return i.call(this,e[0],o);case 2:return i.call(this,e[0],e[1],o)}var r=Array(s+1);for(t=-1;++t<s;)r[t]=e[t];return r[s]=o,i.apply(this,r)}}},{}],26:[function(e,t,n){var o=e("lodash._getnative"),c=e("lodash.isarguments"),l=e("lodash.isarray"),r=/^\d+$/,d=Object.prototype.hasOwnProperty,i=o(Object,"keys"),s=9007199254740991;var a,p=(a="length",function(e){return null==e?void 0:e[a]});function u(e,t){return e="number"==typeof e||r.test(e)?+e:-1,t=null==t?s:t,-1<e&&e%1==0&&e<t}function m(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=s}function h(e){for(var t=function(e){if(null==e)return[];g(e)||(e=Object(e));var t=e.length;t=t&&m(t)&&(l(e)||c(e))&&t||0;var n=e.constructor,o=-1,r="function"==typeof n&&n.prototype===e,i=Array(t),s=0<t;for(;++o<t;)i[o]=o+"";for(var a in e)s&&u(a,t)||"constructor"==a&&(r||!d.call(e,a))||i.push(a);return i}(e),n=t.length,o=n&&e.length,r=!!o&&m(o)&&(l(e)||c(e)),i=-1,s=[];++i<n;){var a=t[i];(r&&u(a,o)||d.call(e,a))&&s.push(a)}return s}function g(e){var t=typeof e;return e&&("object"==t||"function"==t)}var f=i?function(e){var t,n=null==e?void 0:e.constructor;return"function"==typeof n&&n.prototype===e||"function"!=typeof e&&(null!=(t=e)&&m(p(t)))?h(e):g(e)?i(e):[]}:h;t.exports=f},{"lodash._getnative":27,"lodash.isarguments":28,"lodash.isarray":29}],27:[function(e,t,n){var o="[object Function]",r=/^\[object .+?Constructor\]$/;var i=Object.prototype,s=Function.prototype.toString,a=i.hasOwnProperty,c=i.toString,l=RegExp("^"+s.call(a).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(e,t){var n=null==e?void 0:e[t];return function(e){if(null==e)return;if(function(e){return function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)&&c.call(e)==o}(e))return l.test(s.call(e));return function(e){return!!e&&"object"==typeof e}(e)&&r.test(e)}(n)?n:void 0}},{}],28:[function(e,t,n){var o=Object.prototype,r=o.hasOwnProperty,i=o.propertyIsEnumerable,s=9007199254740991;var a,c=(a="length",function(e){return null==e?void 0:e[a]});function l(e){return null!=e&&("number"==typeof(t=c(e))&&-1<t&&t%1==0&&t<=s);var t}t.exports=function(e){return!!(t=e)&&"object"==typeof t&&l(e)&&r.call(e,"callee")&&!i.call(e,"callee");var t}},{}],29:[function(e,t,n){var o="[object Function]",r=/^\[object .+?Constructor\]$/;function i(e){return!!e&&"object"==typeof e}var s,a,c,l=Object.prototype,d=Function.prototype.toString,p=l.hasOwnProperty,u=l.toString,m=RegExp("^"+d.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),h=(s=Array,a="isArray",function(e){return null!=e&&(function(e){return function(e){var t=typeof e;return e&&("object"==t||"function"==t)}(e)&&u.call(e)==o}(e)?m.test(d.call(e)):i(e)&&r.test(e))}(c=null==s?void 0:s[a])?c:void 0);var g=h||function(e){return i(e)&&("number"==typeof(t=e.length)&&-1<t&&t%1==0&&t<=9007199254740991)&&"[object Array]"==u.call(e);var t};t.exports=g},{}],30:[function(e,t,n){var i=e("lodash._createwrapper"),s=e("lodash._replaceholders"),o=e("lodash.restparam"),a=o(function(e,t,n){var o=1;if(n.length){var r=s(n,a.placeholder);o|=32}return i(e,o,t,n,r)});a.placeholder={},t.exports=a},{"lodash._createwrapper":31,"lodash._replaceholders":34,"lodash.restparam":35}],31:[function(a,c,e){(function(R){var C=a("lodash._arraycopy"),s=a("lodash._basecreate"),O=a("lodash._replaceholders"),E=1,T=2,e=4,t=8,n=16,A=32,q=64,o=128,r=/^\d+$/,I=Math.max,U=Math.min,i=9007199254740991;function N(i){return function(){var e=arguments;switch(e.length){case 0:return new i;case 1:return new i(e[0]);case 2:return new i(e[0],e[1]);case 3:return new i(e[0],e[1],e[2]);case 4:return new i(e[0],e[1],e[2],e[3]);case 5:return new i(e[0],e[1],e[2],e[3],e[4]);case 6:return new i(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new i(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var t,n,o=s(i.prototype),r=i.apply(o,e);return n=typeof(t=r),!t||"object"!=n&&"function"!=n?o:r}}function $(p,u,m,h,g,f,v,y,b,x){var w=u&o,k=u&E,_=u&T,j=u&t,P=u&e,S=u&n,L=_?void 0:N(p);return function e(){for(var t=arguments.length,n=t,o=Array(t);n--;)o[n]=arguments[n];if(h&&(o=function(e,t,n){for(var o=n.length,r=-1,i=I(e.length-o,0),s=-1,a=t.length,c=Array(a+i);++s<a;)c[s]=t[s];for(;++r<o;)c[n[r]]=e[r];for(;i--;)c[s++]=e[r++];return c}(o,h,g)),f&&(o=function(e,t,n){for(var o=-1,r=n.length,i=-1,s=I(e.length-r,0),a=-1,c=t.length,l=Array(s+c);++i<s;)l[i]=e[i];for(var d=i;++a<c;)l[d+a]=t[a];for(;++o<r;)l[d+n[o]]=e[i++];return l}(o,f,v)),j||S){var r=e.placeholder,i=O(o,r);if((t-=i.length)<x){var s=y?C(y):void 0,a=I(x-t,0);u|=j?A:q,u&=~(j?q:A),P||(u&=~(E|T));var c=$(p,u,m,j?o:void 0,j?i:void 0,j?void 0:o,j?void 0:i,s,b,a);return c.placeholder=r,c}}var l=k?m:this,d=_?l[p]:p;return y&&(o=function(e,t){for(var n=e.length,o=U(t.length,n),r=C(e);o--;){var i=t[o];e[o]=D(i,n)?r[i]:void 0}return e}(o,y)),w&&b<o.length&&(o.length=b),this&&this!==R&&this instanceof e&&(d=L||N(p)),d.apply(l,o)}}function v(s,e,a,c){var l=e&E,d=N(s);return function e(){for(var t=-1,n=arguments.length,o=-1,r=c.length,i=Array(r+n);++o<r;)i[o]=c[o];for(;n--;)i[o++]=arguments[++t];return(this&&this!==R&&this instanceof e?d:s).apply(l?a:this,i)}}function D(e,t){return e="number"==typeof e||r.test(e)?+e:-1,t=null==t?i:t,-1<e&&e%1==0&&e<t}c.exports=function(e,t,n,o,r,i,s,a){var c=t&T;if(!c&&"function"!=typeof e)throw new TypeError("Expected a function");var l=o?o.length:0;if(l||(t&=~(A|q),o=r=void 0),l-=r?r.length:0,t&q){var d=o,p=r;o=r=void 0}var u,m,h,g=[e,t,n,o,r,d,p,i,s,a];if(g[9]=null==a?c?0:e.length:I(a-l,0)||0,t==E)var f=(u=g[0],m=g[2],h=N(u),function e(){return(this&&this!==R&&this instanceof e?h:u).apply(m,arguments)});else f=t!=A&&t!=(E|A)||g[4].length?$.apply(void 0,g):v.apply(void 0,g);return f}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._arraycopy":32,"lodash._basecreate":33,"lodash._replaceholders":34}],32:[function(e,t,n){t.exports=function(e,t){var n=-1,o=e.length;for(t=t||Array(o);++n<o;)t[n]=e[n];return t}},{}],33:[function(e,t,n){function o(e){if(o=typeof(n=e),n&&("object"==o||"function"==o)){r.prototype=e;var t=new r;r.prototype=void 0}var n,o;return t||{}}function r(){}t.exports=o},{}],34:[function(e,t,n){t.exports=function(e,t){for(var n=-1,o=e.length,r=-1,i=[];++n<o;)e[n]===t&&(e[n]="__lodash_placeholder__",i[++r]=n);return i}},{}],35:[function(e,t,n){arguments[4][25][0].apply(n,arguments)},{dup:25}],36:[function(e,t,n){var o=e("lodash.isarguments"),r=e("lodash.isarray"),i=e("lodash.isfunction"),s=e("lodash.isstring"),a=e("lodash.keys");var c=9007199254740991;var l,d=(l="length",function(e){return null==e?void 0:e[l]});function p(e){return null!=e&&("number"==typeof(t=d(e))&&-1<t&&t%1==0&&t<=c);var t}t.exports=function(e){return null==e||(p(e)&&(r(e)||s(e)||o(e)||(t=e)&&"object"==typeof t&&i(e.splice))?!e.length:!a(e).length);var t}},{"lodash.isarguments":37,"lodash.isarray":38,"lodash.isfunction":39,"lodash.isstring":40,"lodash.keys":41}],37:[function(e,t,n){arguments[4][28][0].apply(n,arguments)},{dup:28}],38:[function(e,t,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],39:[function(e,t,n){var o=Object.prototype.toString;t.exports=function(e){return n=typeof(t=e),!!t&&("object"==n||"function"==n)&&"[object Function]"==o.call(e);var t,n}},{}],40:[function(e,t,n){var o=Object.prototype.toString;t.exports=function(e){return"string"==typeof e||!!(t=e)&&"object"==typeof t&&"[object String]"==o.call(e);var t}},{}],41:[function(e,t,n){arguments[4][26][0].apply(n,arguments)},{dup:26,"lodash._getnative":42,"lodash.isarguments":37,"lodash.isarray":38}],42:[function(e,t,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],43:[function(e,t,n){function o(e){this.cache=e||{}}o.prototype.getData=function(e,t){this.cache[e]||(this.cache[e]={}),t(null,this.cache[e])},o.prototype.storeData=function(e,t,n){this.cache[e]=t,n&&n(null)},t.exports=o},{}],44:[function(e,t,n){var o,s=e("lodash.assign"),a=e("lodash.bind"),r=e("lodash.isempty"),c=e("events").EventEmitter,l=e("jsondiffpatch"),i=e("./commands"),d=e("./utils");((o=function(e,t,n){if(!e)throw new Error("No socket specified");t=t||"",n=n||{},this.socket=e,this.room=t,this.syncing=!1,this.initialized=!1,this.scheduled=!1,this.doc={localVersion:0,serverVersion:0,shadow:{},localCopy:{},edits:[]},n=s({objectHash:function(e){return e.id||e._id||JSON.stringify(e)}},n),this.jsondiffpatch=l.create(n),c.call(this);var o,r=["_onConnected","syncWithServer","applyServerEdit","applyServerEdits","schedule","onRemoteUpdate"];for(var i in r)this[o=r[i]]=a(this[o],this)}).prototype=c.prototype).getData=function(){return this.doc.localCopy},o.prototype.initialize=function(){this.syncing=!0,this.socket.emit(i.join,this.room,this._onConnected)},o.prototype._onConnected=function(e){this.syncing=!1,this.initialized=!0,this.doc.shadow=d.deepCopy(e),this.doc.localCopy=e,this.doc.serverVersion=0,this.socket.on(i.remoteUpdateIncoming,this.onRemoteUpdate),this.emit("connected")},o.prototype.onRemoteUpdate=function(e){this.socket.id!==e&&this.schedule()},o.prototype.schedule=function(){this.scheduled||(this.scheduled=!0,this.syncWithServer())},o.prototype.sync=function(){this.schedule()},o.prototype.syncWithServer=function(){if(this.syncing||!this.initialized)return!1;this.scheduled&&(this.scheduled=!1),this.syncing=!0;var e=this.createDiff(this.doc.shadow,this.doc.localCopy),t=this.doc.localVersion;r(e)||(this.doc.edits.push(this.createDiffMessage(e,t)),this.doc.localVersion++);var n=this.createEditMessage(t);return this.applyPatchTo(this.doc.shadow,d.deepCopy(e)),this.sendEdits(n),!0},o.prototype.createDiff=function(e,t){return this.jsondiffpatch.diff(e,t)},o.prototype.applyPatchTo=function(e,t){this.jsondiffpatch.patch(e,t)},o.prototype.createDiffMessage=function(e,t){return{serverVersion:this.doc.serverVersion,localVersion:t,diff:e}},o.prototype.createEditMessage=function(e){return{room:this.room,edits:this.doc.edits,localVersion:e,serverVersion:this.doc.serverVersion}},o.prototype.sendEdits=function(e){this.socket.emit(i.syncWithServer,e,this.applyServerEdits)},o.prototype.applyServerEdits=function(e){e&&e.localVersion===this.doc.localVersion?(this.doc.edits=[],e.edits.forEach(this.applyServerEdit)):this.emit("error","REJECTED_PATCH"),this.syncing=!1,this.emit("synced"),this.scheduled&&this.syncWithServer()},o.prototype.applyServerEdit=function(e){return e.localVersion===this.doc.localVersion&&e.serverVersion===this.doc.serverVersion&&(r(e.diff)||(this.applyPatchTo(this.doc.shadow,e.diff),this.doc.serverVersion++,this.applyPatchTo(this.doc.localCopy,d.deepCopy(e.diff))),!0)},t.exports=o},{"./commands":45,"./utils":47,events:1,jsondiffpatch:16,"lodash.assign":19,"lodash.bind":30,"lodash.isempty":36}],45:[function(e,t,n){t.exports={join:"diffsync-join",syncWithServer:"diffsync-send-edit",remoteUpdateIncoming:"diffsync-updated-doc",error:"diffsync-error"}},{}],46:[function(e,t,n){var o,r=e("lodash.assign"),i=e("lodash.bind"),s=e("lodash.isempty"),a=e("jsondiffpatch"),c=e("./commands"),l=e("./utils");(o=function(e,t,n){if(!e||!t)throw new Error("Need to specify an adapter and a transport");n=n||{},this.adapter=e,this.transport=t,this.data={},this.requests={},this.saveRequests={},this.saveQueue={},this.trackConnection=i(this.trackConnection,this),n=r({objectHash:function(e){return e.id||e._id||JSON.stringify(e)}},n),this.jsondiffpatch=a.create(n),this.transport.on("connection",this.trackConnection)}).prototype.trackConnection=function(e){e.on(c.join,this.joinConnection.bind(this,e)),e.on(c.syncWithServer,this.receiveEdit.bind(this,e))},o.prototype.joinConnection=function(n,o,r){this.getData(o,function(e,t){n.join(o),t.clientVersions[n.id]={backup:{doc:l.deepCopy(t.serverCopy),serverVersion:0},shadow:{doc:l.deepCopy(t.serverCopy),serverVersion:0,localVersion:0},edits:[]},r(t.serverCopy)})},o.prototype.getData=function(n,o){var e=this.data[n],r=this.data,i=this.requests;e?o(null,e):i[n]?i[n]=!0:(i[n]=!0,this.adapter.getData(n,function(e,t){r[n]={registeredSockets:[],clientVersions:{},serverCopy:t},i[n]=!1,o(null,r[n])}))},o.prototype.receiveEdit=function(o,r,i){this.getData(r.room,function(e,t){var n=t.clientVersions[o.id];!e&&n?(r.serverVersion===n.shadow.serverVersion&&(n.edits=[]),r.edits.forEach(function(e){e.serverVersion===n.shadow.serverVersion&&e.localVersion===n.shadow.localVersion?(n.backup.doc=l.deepCopy(n.shadow.doc),this.jsondiffpatch.patch(n.shadow.doc,l.deepCopy(e.diff)),this.jsondiffpatch.patch(t.serverCopy,l.deepCopy(e.diff)),s(e.diff)||n.shadow.localVersion++):console.log("error","patch rejected!!",e.serverVersion,"->",n.shadow.serverVersion,":",e.localVersion,"->",n.shadow.localVersion)}.bind(this)),this.saveSnapshot(r.room),0<r.edits.length&&this.transport.to(r.room).emit(c.remoteUpdateIncoming,o.id),this.sendServerChanges(t,n,i)):o.emit(c.error,"Need to re-connect!")}.bind(this))},o.prototype.saveSnapshot=function(n){var e=!this.saveRequests[n],o=function(){var e=!0===this.saveQueue[n];this.saveRequests[n]=!1,e&&(this.saveQueue[n]=!1,this.saveSnapshot(n))}.bind(this);e?(this.saveRequests[n]=!0,this.getData(n,function(e,t){!e&&t?this.adapter.storeData(n,t.serverCopy,o):o()}.bind(this))):this.saveQueue[n]=!0},o.prototype.sendServerChanges=function(e,t,n){var o=this.jsondiffpatch.diff(t.shadow.doc,e.serverCopy),r=t.shadow.serverVersion;s(o)||(t.edits.push({serverVersion:r,localVersion:t.shadow.localVersion,diff:o}),t.shadow.serverVersion++,this.jsondiffpatch.patch(t.shadow.doc,l.deepCopy(o))),n({localVersion:t.shadow.localVersion,serverVersion:r,edits:t.edits})},t.exports=o},{"./commands":45,"./utils":47,jsondiffpatch:16,"lodash.assign":19,"lodash.bind":30,"lodash.isempty":36}],47:[function(e,t,n){t.exports={deepCopy:function(e){return null==e?e:JSON.parse(JSON.stringify(e))}}},{}]},{},[2])(2)});var wysihtml5ParserRules={classes:{"wysiwyg-text-align-center":1},tags:{b:{},h1:{},h2:{},h3:{},strong:{rename_tag:"b"},i:{},em:{rename_tag:"i"},hr:{},ul:{},ol:{},li:{},p:{},tt:{},box:{},code:{check_attributes:{id:"any"}},span:{},var:{},img:{check_attributes:{id:"any"}},comment:{remove:1},style:{remove:1}}};!function(){var e="chrome"in window&&window.navigator.userAgent.indexOf("Edge")<0;if(!("u2f"in window)&&e){var a,l=window.u2f={};l.EXTENSION_ID="kmendfapggjehodndflmmgagdbamhnfd",l.MessageTypes={U2F_REGISTER_REQUEST:"u2f_register_request",U2F_REGISTER_RESPONSE:"u2f_register_response",U2F_SIGN_REQUEST:"u2f_sign_request",U2F_SIGN_RESPONSE:"u2f_sign_response",U2F_GET_API_VERSION_REQUEST:"u2f_get_api_version_request",U2F_GET_API_VERSION_RESPONSE:"u2f_get_api_version_response"},l.ErrorCodes={OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5},l.U2fRequest,l.U2fResponse,l.Error,l.Transport,l.Transports,l.SignRequest,l.SignResponse,l.RegisterRequest,l.RegisterResponse,l.RegisteredKey,l.GetJsApiVersionResponse,l.getMessagePort=function(e){if("undefined"!=typeof chrome&&chrome.runtime){var t={type:l.MessageTypes.U2F_SIGN_REQUEST,signRequests:[]};chrome.runtime.sendMessage(l.EXTENSION_ID,t,function(){chrome.runtime.lastError?l.getIframePort_(e):l.getChromeRuntimePort_(e)})}else l.isAndroidChrome_()?l.getAuthenticatorPort_(e):l.isIosChrome_()?l.getIosPort_(e):l.getIframePort_(e)},l.isAndroidChrome_=function(){var e=navigator.userAgent;return-1!=e.indexOf("Chrome")&&-1!=e.indexOf("Android")},l.isIosChrome_=function(){return-1<["iPhone","iPad","iPod"].indexOf(navigator.platform)},l.getChromeRuntimePort_=function(e){var t=chrome.runtime.connect(l.EXTENSION_ID,{includeTlsChannelId:!0});setTimeout(function(){e(new l.WrappedChromeRuntimePort_(t))},0)},l.getAuthenticatorPort_=function(e){setTimeout(function(){e(new l.WrappedAuthenticatorPort_)},0)},l.getIosPort_=function(e){setTimeout(function(){e(new l.WrappedIosPort_)},0)},l.WrappedChromeRuntimePort_=function(e){this.port_=e},l.formatSignRequest_=function(e,t,n,o,r){if(void 0===a||a<1.1){for(var i=[],s=0;s<n.length;s++)i[s]={version:n[s].version,challenge:t,keyHandle:n[s].keyHandle,appId:e};return{type:l.MessageTypes.U2F_SIGN_REQUEST,signRequests:i,timeoutSeconds:o,requestId:r}}return{type:l.MessageTypes.U2F_SIGN_REQUEST,appId:e,challenge:t,registeredKeys:n,timeoutSeconds:o,requestId:r}},l.formatRegisterRequest_=function(e,t,n,o,r){if(void 0===a||a<1.1){for(var i=0;i<n.length;i++)n[i].appId=e;var s=[];for(i=0;i<t.length;i++)s[i]={version:t[i].version,challenge:n[0],keyHandle:t[i].keyHandle,appId:e};return{type:l.MessageTypes.U2F_REGISTER_REQUEST,signRequests:s,registerRequests:n,timeoutSeconds:o,requestId:r}}return{type:l.MessageTypes.U2F_REGISTER_REQUEST,appId:e,registerRequests:n,registeredKeys:t,timeoutSeconds:o,requestId:r}},l.WrappedChromeRuntimePort_.prototype.postMessage=function(e){this.port_.postMessage(e)},l.WrappedChromeRuntimePort_.prototype.addEventListener=function(e,t){var n=e.toLowerCase();"message"==n||"onmessage"==n?this.port_.onMessage.addListener(function(e){t({data:e})}):console.error("WrappedChromeRuntimePort only supports onMessage")},l.WrappedAuthenticatorPort_=function(){this.requestId_=-1,this.requestObject_=null},l.WrappedAuthenticatorPort_.prototype.postMessage=function(e){var t=l.WrappedAuthenticatorPort_.INTENT_URL_BASE_+";S.request="+encodeURIComponent(JSON.stringify(e))+";end";document.location=t},l.WrappedAuthenticatorPort_.prototype.getPortType=function(){return"WrappedAuthenticatorPort_"},l.WrappedAuthenticatorPort_.prototype.addEventListener=function(e,t){if("message"==e.toLowerCase()){window.addEventListener("message",this.onRequestUpdate_.bind(this,t),!1)}else console.error("WrappedAuthenticatorPort only supports message")},l.WrappedAuthenticatorPort_.prototype.onRequestUpdate_=function(e,t){var n=JSON.parse(t.data),o=(n.intentURL,n.errorCode,null);n.hasOwnProperty("data")&&(o=JSON.parse(n.data)),e({data:o})},l.WrappedAuthenticatorPort_.INTENT_URL_BASE_="intent:#Intent;action=com.google.android.apps.authenticator.AUTHENTICATE",l.WrappedIosPort_=function(){},l.WrappedIosPort_.prototype.postMessage=function(e){var t=JSON.stringify(e),n="u2f://auth?"+encodeURI(t);location.replace(n)},l.WrappedIosPort_.prototype.getPortType=function(){return"WrappedIosPort_"},l.WrappedIosPort_.prototype.addEventListener=function(e,t){"message"!==e.toLowerCase()&&console.error("WrappedIosPort only supports message")},l.getIframePort_=function(t){var e="chrome-extension://"+l.EXTENSION_ID,n=document.createElement("iframe");n.src=e+"/u2f-comms.html",n.setAttribute("style","display:none"),document.body.appendChild(n);var o=new MessageChannel,r=function(e){"ready"==e.data?(o.port1.removeEventListener("message",r),t(o.port1)):console.error('First event on iframe port was not "ready"')};o.port1.addEventListener("message",r),o.port1.start(),n.addEventListener("load",function(){n.contentWindow.postMessage("init",e,[o.port2])})},l.EXTENSION_TIMEOUT_SEC=30,l.port_=null,l.waitingForPort_=[],l.reqCounter_=0,l.callbackMap_={},l.getPortSingleton_=function(e){l.port_?e(l.port_):(0==l.waitingForPort_.length&&l.getMessagePort(function(e){for(l.port_=e,l.port_.addEventListener("message",l.responseHandler_);l.waitingForPort_.length;)l.waitingForPort_.shift()(l.port_)}),l.waitingForPort_.push(e))},l.responseHandler_=function(e){var t=e.data,n=t.requestId;if(n&&l.callbackMap_[n]){var o=l.callbackMap_[n];delete l.callbackMap_[n],o(t.responseData)}else console.error("Unknown or missing requestId in response.")},l.sign=function(t,n,o,r,i){void 0===a?l.getApiVersion(function(e){a=void 0===e.js_api_version?0:e.js_api_version,console.log("Extension JS API Version: ",a),l.sendSignRequest(t,n,o,r,i)}):l.sendSignRequest(t,n,o,r,i)},l.sendSignRequest=function(r,i,s,a,c){l.getPortSingleton_(function(e){var t=++l.reqCounter_;l.callbackMap_[t]=a;var n=void 0!==c?c:l.EXTENSION_TIMEOUT_SEC,o=l.formatSignRequest_(r,i,s,n,t);e.postMessage(o)})},l.register=function(t,n,o,r,i){void 0===a?l.getApiVersion(function(e){a=void 0===e.js_api_version?0:e.js_api_version,console.log("Extension JS API Version: ",a),l.sendRegisterRequest(t,n,o,r,i)}):l.sendRegisterRequest(t,n,o,r,i)},l.sendRegisterRequest=function(r,i,s,a,c){l.getPortSingleton_(function(e){var t=++l.reqCounter_;l.callbackMap_[t]=a;var n=void 0!==c?c:l.EXTENSION_TIMEOUT_SEC,o=l.formatRegisterRequest_(r,s,i,n,t);e.postMessage(o)})},l.getApiVersion=function(r,i){l.getPortSingleton_(function(e){if(e.getPortType){var t;switch(e.getPortType()){case"WrappedIosPort_":case"WrappedAuthenticatorPort_":t=1.1;break;default:t=0}r({js_api_version:t})}else{var n=++l.reqCounter_;l.callbackMap_[n]=r;var o={type:l.MessageTypes.U2F_GET_API_VERSION_REQUEST,timeoutSeconds:void 0!==i?i:l.EXTENSION_TIMEOUT_SEC,requestId:n};e.postMessage(o)}})}}}(),angular.module("grademanagerApp",["ngAnimate","ngMessages","ngRoute","ngSanitize","ngMaterial","ui.tree","ui.router","ui.router.state.events","IeHelper","ngFileUpload","ui.codemirror","validation.match","duScroll","md.data.table","ngRaven"]).config(["$stateProvider","$urlRouterProvider",function(e,t){"use strict";t.otherwise("/"),e.state("home",{url:"/",templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"home"}).state("profile",{url:"/profile",templateUrl:"views/profile.html",controller:"ProfileCtrl",controllerAs:"profile"}).state("edit",{url:"/:project/edit",templateUrl:"views/edit.html",controller:"EditCtrl",controllerAs:"editor",reloadOnSearch:!1}).state("scan",{url:"/:project/scan",templateUrl:"views/scan.html",controller:"ScanCtrl",controllerAs:"scan"}).state("scan.manual",{url:"/:student/:page::copy",templateUrl:"views/scan.preview.html",controller:"ScanPreviewCtrl",controllerAs:"preview"}).state("grade",{url:"/:project/grade",templateUrl:"views/grade.html",controller:"GradeCtrl",controllerAs:"grade"}).state("options",{url:"/:project/options",templateUrl:"views/options.html",controller:"OptionsCtrl",controllerAs:"ctrl"}).state("history",{url:"/:project/history",templateUrl:"views/history.html",controller:"HistoryCtrl",controllerAs:"ctrl"}).state("admin_stats",{url:"/admin/stats",templateUrl:"views/admin/stats.html",controller:"AdminStatsCtrl",controllerAs:"ctrl"})}]).config(["$mdIconProvider",function(e){"use strict";e.defaultFontSet("mdi")}]).config(["$mdThemingProvider",function(e){"use strict";e.theme("default").primaryPalette("blue").accentPalette("grey",{default:"200"})}]).config(["$httpProvider",function(e){"use strict";e.interceptors.push("authInterceptor")}]).value("duScrollGreedy",!0).value("duScrollBottomSpy",!0),angular.forEach([{ngAttrName:"ngXlinkHref",attrName:"xlink:href"}],function(e){"use strict";var r=e.ngAttrName,i=e.attrName;angular.module("grademanagerApp").directive(r,["IeHelperSrv",function(o){return{priority:99,link:function(e,t,n){n.$observe(r,function(e){e&&(n.$set(i,e),o.isIE&&t.prop(i,e))})}}}])});var checkForIE={init:function(){"use strict";this.isIE=-1!==navigator.userAgent.indexOf("MSIE")}};function GUID(){"use strict";return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}angular.module("IeHelper",[]).factory("IeHelperSrv",function(){"use strict";return{isIE:checkForIE.isIE}}),checkForIE.init(),angular.module("grademanagerApp").controller("AppCtrl",["$scope","$state","$stateParams","$timeout","$window","$location","auth","API",function(e,t,n,o,r,i,s,a){"use strict";var c=this;this.tabIndex=0,this.tabInit=!1,this.hideTabs=!0,this.api=a,this.project=function(){return n.project},this.getUsername=function(){return s.getUsername()},this.getUser=function(){return s.getUser()},this.isAuthed=function(){var e=s.isAuthed();return e||t.is("home")||o(function(){t.go("home")}),e},this.logout=function(){s.logout(),c.go("home")},this.go=function(e){c.tabInit&&!t.includes(e)?t.go(e,{project:n.project}):c.tabInit=!0},this.linkTo=function(e){return a.URL+"/project/"+n.project+"/static/"+e+"?token="+s.getToken()},e.$on("$stateChangeSuccess",function(){r.ga&&r.ga("send","pageview",i.path()),c.hideTabs=!0,t.includes("edit")&&(c.tabIndex=0,c.hideTabs=!1),t.includes("scan")&&(c.tabIndex=1,c.hideTabs=!1),t.includes("grade")&&(c.tabIndex=2,c.hideTabs=!1),t.includes("options")&&(c.tabIndex=3,c.hideTabs=!1),t.includes("history")&&(c.tabIndex=4,c.hideTabs=!1)})}]),angular.module("grademanagerApp").controller("AssociationCtrl",["$mdDialog","row","API","students","scores","unmatched","$stateParams","auth","$sce","$http",function(e,n,o,t,r,i,s,a,c,l){"use strict";var d=this;d.scores=r,d.unmatched=i,d.students=t,d.filterUnmatched=function(e){return!d.scores.hasOwnProperty(e.id)},d.nameSrc=function(){return d.match&&d.match.image?c.trustAsResourceUrl(o.URL+"/project/"+s.project+"/static/cr/"+d.match.image+"?token="+a.getToken()):""},l.get(o.URL+"/project/"+s.project+"/names").then(function(e){var t=e.data;d.names=t,d.match=function(e,t){for(var n=0;n<e.length;n++)if(e[n].student===t.student&&e[n].copy===t.copy)return e[n]}(t,n)||d.nextUnmatched()}),d.unmatchedRemaining=Object.keys(d.unmatched).length,d.nextUnmatched=function(){return d.names.filter(function(e){return!e.auto&&!e.manual&&!e.skip}).pop()},d.selectedItemChange=function(e){if(e&&e.id){d.match.manual=e.id;var t=d.match.student+":"+d.match.copy,n=d.unmatched[t];n&&(n.id=e.id,d.scores[n.id]=n,delete d.unmatched[t],l.post(o.URL+"/project/"+s.project+"/association/manual",{student:n.student,copy:n.copy,id:n.id})),d.match=d.nextUnmatched(),d.searchText="",d.selectedItem=void 0,d.unmatchedRemaining=Object.keys(d.unmatched).length}},d.skip=function(){d.match.skip=!0,d.match=d.nextUnmatched()},d.closeDialog=function(){e.hide()}}]),angular.module("grademanagerApp").controller("HomeCtrl",["$scope","$state","$mdDialog","$window","auth","exam","API",function(e,t,n,o,r,i,s){"use strict";var a=this;a.API=s,a.version="ce14abb",a.isAuthed=function(){return r.isAuthed()},a.logout=function(){r.logout()},a.login=function(){a.error="",r.login(a.username,a.password).then(function(e){e.data.u2f?(a.error={error:"Please insert U2F Key!"},o.u2f.sign("https://amcui.ig.he-arc.ch",a.username,[e.data.u2f],function(e){a.error={error:"Thank you!"},r.u2fReply(a.username,e).then(s.getProjectList,function(e){a.error={error:e}})})):s.getProjectList(e.data)},function(e){401===e.status&&(a.error={error:"Wrong user or password"})})},a.openProject=function(e){e.status&&e.status.annotated?t.go("grade",{project:e.project}):e.status&&e.status.printed?t.go("scan",{project:e.project}):t.go("edit",{project:e.project},{reload:!0})},a.createProject=function(){a.error="",a.newProjectName=a.newProjectName.trim().toLowerCase(),s.createProject(a.newProjectName).then(function(e){a.openProject({project:e.data}),a.newProjectName=""},function(e){a.error={error:e}})},a.copyProject=function(e,t){n.show({clickOutsideToClose:!1,targetEvent:e,templateUrl:"views/promptdialog.html",controller:"PromptDialogCtrl",controllerAs:"ctrl",locals:{options:{title:"Copy project "+t.project,content:"Provide a name for the new copy:",label:"new name",value:""}}}).then(function(e){e=e.trim().toLowerCase().replace(/[^\-a-z0-9\_]/g,""),s.copyProject(t.project,e).then(function(){a.openProject({project:e})})})},e.$watch("home.search",function(){a.search&&(a.selectedTab=1)}),a.isAuthed()&&s.getProjectList()}]),angular.module("grademanagerApp").controller("EditCtrl",["$scope","$mdSidenav","$mdDialog","$mdToast","$location","$state","$stateParams","$timeout","API","exam",function(n,e,t,o,r,i,s,a,c,l){"use strict";var d,p=this;function u(){d&&a.cancel(d),(new Date).getTime()-p.lastPreview>p.waitTime?(p.previewWait=!1,l.preview(),p.lastPreview=(new Date).getTime()):(p.previewWait=!0,d=a(u,p.waitTime))}p.examService=l,p.API=c,p.location=r,c.loadProject(s.project),n.$watch(function(){return r.search().section},function(e){if(p.examService.exam&&p.examService.exam.sections){var t=p.examService.exam.sections.indexOf(p.section);-1<t&&-1<e&&e!==t&&(p.section=p.examService.exam.sections[e])}}),n.$watch("editor.section",function(e){if(p.examService.exam&&p.examService.exam.sections){var t=p.examService.exam.sections.indexOf(e);-1<t&&r.search().section!==t&&r.search({section:t})}}),p.lastPreview=0,p.waitTime=5e3,p.previewWait=!1,p.linkToQuestion=function(e,t){return"#!/"+s.project+"/edit?section="+l.exam.sections.indexOf(e)+"#q"+(t?t.number:"0")},setTimeout(function(){l.load(function(e){var t;n.$watch("editor.examService.exam",function(){p.examService.computeHierarchyNumbers(),e.sync(),u()},!0),n.$on("$destroy",function(){e.removeAllListeners()}),p.examService.exam&&p.examService.exam.sections&&0<p.examService.exam.sections.length?p.section=p.examService.exam.sections[r.search().section||0]:(p.section=p.examService.newSection(),p.examService.exam.sections=[p.section]),function(){var e=localStorage.getItem("copy");if(e&&(e=angular.fromJson(e)).dest===s.project){for(var t in e.sections)if(e.sections.hasOwnProperty(t)){var n=e.sections[t];n.id=GUID(),n.questions=n.questions.map(function(e){return p.examService.copyQuestion(n,e)}),l.exam.sections.push(n)}l.exam.graphics||(l.exam.graphics={}),l.exam.codes||(l.exam.codes={}),angular.extend(l.exam.graphics,e.graphics),angular.extend(l.exam.codes,e.codes),c.copyGraphics(e.src,e.dest),c.copyCodes(e.src,e.dest),o.show(o.simple().content("Content has been copied!").position("top right")),localStorage.removeItem("copy")}}(),(t=localStorage.getItem("import"))&&(l.importJSON(t),localStorage.removeItem("import"),a(function(){i.go("edit",{project:s.project},{reload:!0})},1e3))})},500),p.leftNav=function(){return e("left")},p.rightNav=function(){return e("right")},p.previousSection=function(){if(p.examService.exam&&p.examService.exam.sections){var e=p.examService.exam.sections.indexOf(p.section);if(0<e)return p.examService.exam.sections[e-1]}},p.nextSection=function(e){if(p.examService.exam&&p.examService.exam.sections){var t=p.examService.exam.sections.indexOf(p.section);if(t<p.examService.exam.sections.length-1)return p.examService.exam.sections[t+1];var n=p.examService.newSection();return e&&a(function(){p.examService.exam.sections.push(n)}),n}},p.removeSection=function(e){var t=p.previousSection();t=t||p.nextSection(!0),p.examService.exam.sections.splice(p.examService.exam.sections.indexOf(e),1),p.section=t},p.range=function(e){return new Array(parseInt(e))},p.latexSourceOptions={mode:"stex",lineNumbers:!0,lineWrapping:!0,viewportMargin:1/0,readOnly:!1,matchBrackets:!0,autoCloseBrackets:!0},p.latexPreviewOptions={mode:"stex",lineNumbers:!0,lineWrapping:!0,viewportMargin:1/0,readOnly:!0,matchBrackets:!0},p.jsonPreviewOptions={mode:"application/json",lineNumbers:!0,lineWrapping:!0,viewportMargin:1/0,readOnly:!0,matchBrackets:!0},p.jsonImportOptions={mode:"application/json",lineNumbers:!0,lineWrapping:!0,viewportMargin:1/0,readOnly:!1,matchBrackets:!0},p.questionIsNoneCorrect=function(e){return e.answers.every(function(e){return!e.correct})},p.showPreviewDialog=function(e){t.show({clickOutsideToClose:!0,templateUrl:"views/edit.preview.html",targetEvent:e,controller:"EditPreviewCtrl",controllerAs:"ctrl"})},p.showPropertiesManager=function(e){t.show({clickOutsideToClose:!0,templateUrl:"views/propertiesmanager.html",targetEvent:e,controller:"PropertiesManagerCtrl",controllerAs:"ctrl"})},p.highlightSearch=function(e){if(p.searchQuery.length<3)return"";var t=new RegExp(p.searchQuery,"i"),n=e.search(t),o=p.searchQuery.length,r="";for(10<n&&(r+="...");-1<n;)r+=e.substr(Math.max(0,n-10),Math.min(o+20,e.length))+"...",n=(e=e.slice(n+p.searchQuery.length)).search(t);return r},p.search=function(){if(p.searchQuery.length<3)p.searchResults=[];else try{p.searchResults=JSON.search(p.examService.exam.sections,new RegExp(p.searchQuery,"i"));var n=[];p.searchResults=p.searchResults.filter(function(e){if(e.inKey)return!1;var t=JSON.stringify(e.chain);return n.indexOf(t)<0&&(n.push(t),!0)})}catch(e){p.searchResults=[]}},p.examMenuOptions={accept:function(e,t){return(e.$modelValue.hasOwnProperty("questions")?"section":"question")===t.$element.attr("data-type")}},p.copy={},p.copyCheckbox={},p.copySummary=function(){var e=Object.keys(p.copy).length;return{sections:e,questions:Object.keys(p.copyCheckbox).length-e}},p.toggleCopy=function(e,t){var n,o;p.copy.hasOwnProperty(e.id)?(n=p.copy[e.id],t?(o=function(e,t){for(var n=0;n<e.length;n++)if(e[n].id===t)return e[n]}(n.questions,t.id))?(n.questions.splice(n.questions.indexOf(o),1),p.copyCheckbox[t.id]=!1):(n.questions.splice(e.questions.indexOf(t),0,angular.copy(t)),p.copyCheckbox[t.id]=!0):(n.questions.forEach(function(e){p.copyCheckbox[e.id]=!1}),p.copyCheckbox[e.id]=!1,delete p.copy[e.id])):(n=angular.copy(e),p.copy[e.id]=n,p.copyCheckbox[n.id]=!0,t?(n.questions=[],n.questions.splice(e.questions.indexOf(t),0,angular.copy(t)),p.copyCheckbox[t.id]=!0):n.questions.forEach(function(e){p.copyCheckbox[e.id]=!0}))},p.copyTo=function(){var e=p.copyToName,t={src:s.project,dest:e,sections:p.copy,graphics:{},codes:{}};t.graphics=angular.copy(l.exam.graphics),t.codes=angular.copy(l.exam.codes),localStorage.setItem("copy",angular.toJson(t)),i.go("edit",{project:e},{reload:!0})}}]),angular.module("grademanagerApp").controller("ScanCtrl",["$scope","$mdMedia","$http","$state","$stateParams","API","Upload","$mdDialog",function(e,t,n,o,r,i,s,a){"use strict";var c=this;function l(){0<c.pages.length&&c.delete(c.pages[0]).then(l)}function d(){n.get(i.URL+"/project/"+r.project+"/capture").then(function(e){var t=e.data;if(c.pages=t,o.params.student&&o.params.page&&o.params.copy)for(var n=0;n<t.length;n++)t[n].id===o.params.student+"/"+o.params.page+":"+o.params.copy&&(c.page=t[n])}),n.get(i.URL+"/project/"+r.project+"/missing").then(function(e){c.missing=e.data})}i.loadProject(r.project),e.$mdMedia=t,c.orderBy="id",c.reverse=!1,c.uploads=[],c.sort=function(e){e===c.orderBy?c.reverse=!c.reverse:c.orderBy=e},this.loadPage=function(e){(c.page=e).project=r.project,o.go("scan.manual",e)},this.delete=function(e){return n.post(i.URL+"/project/"+r.project+"/capture/delete",e).then(function(){c.pages.splice(c.pages.indexOf(e),1)})},this.deleteAll=function(){a.show(a.confirm().title("Warning!").content("This will remove all scans, grades and matchings. Do you want to continue?").ok("Delete All").cancel("Cancel")).then(l)},e.$watch("scan.files",function(){var t;c.files&&(t=c.files,c.uploads.push(t),s.upload({url:i.URL+"/project/"+r.project+"/upload",file:t}).progress(function(e){t.progress=100*e.loaded/e.total}).then(function(){d()}))}),d()}]),angular.module("grademanagerApp").controller("ScanPreviewCtrl",["$http","$mdMedia","$mdSidenav","$stateParams","$sce","API","auth",function(e,t,n,o,r,i,s){"use strict";var a=this;e.get(i.URL+"/project/"+o.project+"/capture/"+o.student+"/"+o.page+":"+o.copy).then(function(e){a.page=e.data}),e.get(i.URL+"/project/"+o.project+"/zones/"+o.student+"/"+o.page+":"+o.copy).then(function(e){a.zones=e.data}),t("sm")&&n("right").open(),this.pageSrc=function(){return a.page&&a.page.layout_image?r.trustAsResourceUrl(i.URL+"/project/"+o.project+"/static/cr/"+a.page.layout_image+"?token="+s.getToken()):""},a.ticked=function(e){return 0<=e.manual?1===e.manual:!(e.total<=0)&&e.black>=i.options.options.seuil*e.total},a.toggle=function(e){0===e.manual?e.manual=1:1===e.manual?e.manual=0:e.manual=e.black>=i.options.options.seuil*e.total?0:1,i.setZoneManual(o.project,{student:o.student,page:o.page,copy:o.copy,manual:e.manual,type:4,id_a:e.question,id_b:e.answer})},a.clear=function(){a.zones.forEach(function(e){e.manual=-1}),i.setPageAuto(o.project,{student:o.student,page:o.page,copy:o.copy})}}]),angular.module("grademanagerApp").controller("GradeCtrl",["$scope","$q","$mdMedia","$http","$timeout","$stateParams","API","auth","$mdDialog",function(o,e,t,n,r,i,s,a,c){"use strict";var l,d,p=this;function u(){l&&r.cancel(l),l=r(function(){n({method:"POST",url:s.URL+"/project/"+i.project+"/csv",headers:{"Content-Type":"text/plain"},data:Papa.unparse(angular.copy(p.students))}).then(m)},1e3)}function m(){n.get(s.URL+"/project/"+i.project+"/scores").then(function(e){p.scores={},p.unmatched={},p.questions={},p.whys={},p.maxPoints=0,e.data.forEach(function(e){var t=e.student+":"+e.copy,n=t,o="unmatched";e.id&&function(e){for(var t=0;t<p.students.data.length;t++)if(String(p.students.data[t].id)===String(e))return 1}(e.id)&&(n=e.id,o="scores"),p[o].hasOwnProperty(n)||(p[o][n]={id:e.id,key:t,student:e.student,copy:e.copy,questions:{},total:0}),p.questions.hasOwnProperty(e.title)||(p.questions[e.title]={max:e.max,question:e.question,page:e.page},p.maxPoints+=e.max),p[o][n].total+=e.score,p[o][n].questions[e.title]=e.score,p.whys[t+":"+e.question]=e.why}),s.options.options.points_max||(s.options.options.points_max=p.maxPoints),s.options.options.final_grade_formula||(s.options.options.final_grade_formula="row.Grade"),p.test={getter:function(e){if(p.scores.hasOwnProperty(e))return p.scores[e].total},minGrade:s.options.options.note_min,maxGrade:s.options.options.note_max,roundingFormula:"round",roundingUnit:s.options.options.note_grain},p.isLoading=!1},function(){p.isLoading=!1})}s.loadProject(i.project),p.project=i.project,p.statsOrder="title",p.hideAdd=t("sm"),p.students={fields:["id"],data:[]},p.files=[],p.isLoading=!0,n.get(s.URL+"/project/"+i.project+"/csv").then(function(e){p.parseCSV(e.data),o.$watch("grade.students",u,!0),m()}),n.get(s.URL+"/project/"+i.project+"/stats").then(function(e){p.stats=e.data}),this.getStudentById=function(e){for(var t=0;t<p.students.data.length;t++)if(p.students.data[t].id===e)return p.students.data[t]},p.parseCSV=function(e){var t=Papa.parse(e,{header:!0,dynamicTyping:!0,skipEmptyLines:!0});t.meta.fields.forEach(function(e){p.students.fields.indexOf(e)<0&&p.students.fields.push(e)}),t.data.forEach(function(e){var t;e.hasOwnProperty("id")||(e.id=p.students.data.reduce(function(e,t){return!isNaN(t.id)&&t.id>e?t.id:e},0)+1),(t=h.getStudentById(e.id))?angular.extend(t,e):p.students.data.push(e)})},p.parsePasteData=function(){p.parseCSV(p.pasteData),p.pasteData=""},p.parseAsNewFile=function(){g(p.pasteData)},p.export=function(){p.pasteData=Papa.unparse(angular.copy(p.students))},p.removeStudent=function(e){p.scores[e.id]&&p.unmatchStudent(e),p.students.data.splice(p.students.data.indexOf(e),1)},p.unmatchStudent=function(e){var t=p.scores[e.id];n.post(s.URL+"/project/"+i.project+"/association/manual",{student:t.student,copy:t.copy,id:"NULL"}).then(m)},p.removeCol=function(e){"id"!==e&&p.students.fields.splice(p.students.fields.indexOf(e),1)},p.annotateScore=function(e){n.post(s.URL+"/project/"+i.project+"/annotate",{ids:[e.copy?e.student+":"+e.copy:e.student]})},p.annotateAll=function(){n.post(s.URL+"/project/"+i.project+"/annotate")},p.showAssociationDialog=function(e,t){c.show({clickOutsideToClose:!0,templateUrl:"views/association.html",targetEvent:e,controller:"AssociationCtrl",controllerAs:"ctrl",locals:{row:t,scores:p.scores,unmatched:p.unmatched,students:p.students}})},p.renameColumn=function(e,n,o,r){var i=n[o];c.show({clickOutsideToClose:!1,targetEvent:e,templateUrl:"views/promptdialog.html",controller:"PromptDialogCtrl",controllerAs:"ctrl",locals:{options:{title:"Rename column ",content:"",label:"Column name",value:i}}}).then(function(t){t&&t!==i&&(n[o]=t,r.forEach(function(e){e.hasOwnProperty(i)&&(e[t]=e[i],delete e[i])}),p.save())})},p.finalGrade="row.Grade * 0.5 + row.NoteCC * 0.5",p.valueSaver=function(e,t,n){return p.students.fields.indexOf(t)<0&&p.students.fields.push(t),isNaN(n)||""===n||null===n||(n=parseFloat(n.toFixed(2)),e[t]!==n&&(e[t]=n)),n},p.calculate=function(e,t,n){return p.valueSaver(e,t,p.minMaxRoundGrade(p.makeFunc(n)(e),1,6,"round",.1))},p.minMaxRoundGrade=function(e,t,n,o,r){return Math.max(t,Math.min(n,Math[o](e*(1/r))*r))},p.grade=function(e,t,n,o,r,i){return n=parseFloat(n),o=parseFloat(o),i=parseFloat(i),p.minMaxRoundGrade(e/t*(o-n)+n,n,o,r,i)},p.avgTotalStudent=function(n){var e=p.students.data.reduce(function(e,t){return""===t[n]||isNaN(t[n])||(e.total+=t[n],e.count++),e},{total:0,count:0});return e.total/e.count},p.avg=function(e){var t,n=0,o=0;for(t in p.scores)p.scores.hasOwnProperty(t)&&(o++,n+=e(p.scores[t]));for(t in p.unmatched)p.unmatched.hasOwnProperty(t)&&(o++,n+=e(p.unmatched[t]));return(n/o).toFixed(2)},p.avgTotal=function(){return p.avg(function(e){return e.total})},p.avgQuestion=function(t){return p.avg(function(e){return e.questions[t]})},p.dataTable=function(e){var t=[[],[],[],[],[]];if(p.students.data.length<=0)p.table=t;else{for(var n=e.variable-5;n<=5+parseInt(e.variable);n++){for(var o={count:0,total:0,pass:0,remed:0,fail:0},r=0;r<p.students.data.length;r++){var i=e.formula.getter(p.students.data[r].id);if(!isNaN(i)){var s=p.grade(i,n,e.formula.minGrade,e.formula.maxGrade,e.formula.roundingFormula,e.formula.roundingUnit);4<=s?o.pass++:3.5<=s?o.remed++:o.fail++,o.total+=s,o.count++}}t[0].push(n),t[1].push(o.total/o.count),t[2].push(o.pass/o.count*100),t[3].push(o.remed/o.count*100),t[4].push(o.fail/o.count*100)}p.table=t}},p.editCell=function(e,t,n){if(["Total","FinalGrade","Grade"].indexOf(n)<0){var o=t[n];c.show({clickOutsideToClose:!1,targetEvent:e,templateUrl:"views/promptdialog.html",controller:"PromptDialogCtrl",controllerAs:"ctrl",locals:{options:{title:"Edit value",content:"",label:"Value "+n+" for "+t.name,value:o}}}).then(function(e){e&&e!==o&&(t[n]=e,p.save())})}};var h=this;function g(e,n){n=n||"CSV#"+h.files.length,r(function(){var t;Papa.parse(e,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:(t=n,function(e){o.$apply(function(){e.name=t,e.studentLookup="row.name.toLowerCase()",e.fileLookup='(row["First Name"]  +  " " + row.last_name).toLowerCase()',e.demoid=1,h.files.push(e),h.save(),p.pasteData="",p.tabIndex=p.files.length+1})})})})}n.get(s.URL+"/project/"+i.project+"/gradefiles").then(function(e){h.files=e.data||[]},function(){h.files=[]}),h.save=function(){n.post(s.URL+"/project/"+i.project+"/gradefiles",p.files)},this.makeFunc=function(e){return new Function("row","try{ return "+e+'; } catch (e) { return "error"; }')},this.lookup=function(e,t,n){var o=this.makeFunc(t)(e),r=[];if(o){var i=this.makeFunc(n);p.students.data.forEach(function(e){i(e)===o&&r.push(e.id)})}return r},this.demoStudent=function(e){return h.makeFunc(e.studentLookup)(h.getStudentById(parseInt(e.demoid)))},this.import=function(e){var o=this.makeFunc(e.studentLookup),t=this.makeFunc(e.fileLookup),r=[];for(var n in e.meta.selected)if(e.meta.selected.hasOwnProperty(n)){var i=e.meta.fields[n];r.push(i),p.students.fields.indexOf(i)<0&&p.students.fields.push(i)}e.data.forEach(function(n){var e=t(n);e&&h.students.data.forEach(function(t){o(t)===e&&r.forEach(function(e){t[e]=n[e]})})}),p.tabIndex=0},this.removeFile=function(e){h.files.splice(h.files.indexOf(e),1),h.save()},(d=document.getElementById("dropbox")).addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault(),d.classList.toggle("dragover",!0)},!1),d.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1),d.addEventListener("dragleave",function(e){e.stopPropagation(),e.preventDefault(),d.classList.toggle("dragover",!1)},!1),d.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),d.classList.toggle("dragover",!1),function(e){for(var t=0;t<e.length;t++){var n=e[t];g(n,n.name)}}(e.dataTransfer.files)},!1)}]),angular.module("grademanagerApp").controller("OptionsCtrl",["$scope","$state","$stateParams","$http","$mdToast","auth","API","$window",function(e,t,o,n,r,i,s,a){"use strict";var c=this;s.loadProject(o.project),c.options=s.options,c.types=["none","circle","mark","box"],c.colors=["#000000","#ff0000","#00ff00","#0000ff"],c.fields=[],c.downloadURL=s.URL+"/project/"+o.project+"/zip?token="+i.getToken(),c.downloadODSURL=s.URL+"/project/"+o.project+"/ods?token="+i.getToken(),c.downloadCSVURL=s.URL+"/project/"+o.project+"/static/students.csv?token="+i.getToken(),c.scoringURL=s.URL+"/project/"+o.project+"/scoring?token="+i.getToken(),c.markURL=s.URL+"/project/"+o.project+"/mark?token="+i.getToken(),c.resetLockURL=s.URL+"/project/"+o.project+"/reset/lock?token="+i.getToken(),c.saveOptions=function(){s.saveOptions(c.options.options).then(function(){r.show(r.simple().content("Options saved!").position("top right"))})},c.deleteProject=function(){a.confirm("Are you sure you want to delete all data of "+s.project+" ?")&&s.deleteProject().then(function(){t.go("home")})},c.renameProject=function(){var e=a.prompt("Rename project to",s.project);e&&s.renameProject(e).then(function(e){t.go("options",{project:e.data},{reload:!0})})},c.addColToFilename=function(e){c.options.options.modele_regroupement+=" ("+e+")"},c.addColToAnnotation=function(e){c.options.options.verdict+=" %("+e+")"},n.get(s.URL+"/project/"+o.project+"/csv").then(function(e){var t=Papa.parse(e.data,{header:!0,dynamicTyping:!0,skipEmptyLines:!0});c.fields=t.meta.fields.sort()}),e.$watch("ctrl.options.users",function(t,n){n.filter(function(e){return t.indexOf(e)<0}).forEach(function(e){e!==i.getUsername()?s.removeUser(e,o.project):c.options.users.push(i.getUsername())}),t.filter(function(e){return n.indexOf(e)<0}).forEach(function(e){e!==i.getUsername()&&s.addUser(e,o.project)})},!0)}]),angular.module("grademanagerApp").controller("ProgressDialogCtrl",["$mdDialog","API",function(e,t){"use strict";this.api=t,this.closeDialog=function(){e.hide()}}]),angular.module("grademanagerApp").controller("PromptDialogCtrl",["$mdDialog","options",function(e,t){"use strict";var n=this;n.options=t,n.closeDialog=function(){e.cancel()},n.saveDialog=function(){e.hide(n.options.value)}}]),angular.module("grademanagerApp").controller("CodeEditorCtrl",["$mdDialog","$timeout","code",function(e,t,n){"use strict";var o=this;o.code=n,o.options=function(){return{mode:n.mode,lineNumbers:n.numbers,viewportMargin:1/0,matchBrackets:!0,autoCloseBrackets:!0,autoCloseTags:!0,matchTags:{bothTags:!0}}},t(function(){o.load=!0},500),o.closeDialog=function(){e.hide()}}]),angular.module("grademanagerApp").controller("EditPreviewCtrl",["$mdDialog","API","$stateParams","auth","$sce",function(e,t,n,o,r){"use strict";var i=this;i.api=t,i.previewSrc=function(){return r.trustAsUrl(t.URL+"/project/"+n.project+"/static/out/out.pdf?token="+o.getToken())},i.getErr=function(){if(i.api.logs&&i.api.logs.preview)return i.api.logs.preview.log.match(/ERR(?::|>).*/g)},i.getWarn=function(){if(i.api.logs&&i.api.logs.preview)return i.api.logs.preview.log.match(/pdfTeX warning.*/g)},i.getFull=function(){if(i.api.logs&&i.api.logs.preview)return i.api.logs.preview.log.match(/(?:Over|Under)full.*/g)},i.logOptions={lineNumbers:!1,lineWrapping:!1,viewportMargin:1/0,readOnly:!0},i.closeDialog=function(){e.hide()}}]),angular.module("grademanagerApp").controller("GraphicsManagerCtrl",["$scope","$timeout","$mdDialog","$stateParams","$http","API","exam","Upload",function(e,o,t,r,n,i,s,a){"use strict";var c=this;function l(){var e=[];for(var t in c.examService.exam.graphics)c.examService.exam.graphics.hasOwnProperty(t)&&-1===c.uploads.indexOf(c.examService.exam.graphics[t])&&e.push(c.examService.exam.graphics[t]);e.sort(function(e,t){return e.name>t.name?1:-1}),c.graphics=c.uploads.slice(0).concat(e)}c.examService=s,c.uploads=[],c.graphics=[],c.progress={},c.deleteGraphics=function(e){c.examService.deleteGraphics(e),-1<c.uploads.indexOf(e)&&c.uploads.splice(c.uploads.indexOf(e),1),l()},n.get(i.URL+"/project/"+r.project+"/graphics/sync").then(function(e){e.data.forEach(function(e){var t=e.replace(/(.*)\..*?$/,"$1");if(s.exam.hasOwnProperty("graphics")||(s.exam.graphics={}),!s.exam.graphics.hasOwnProperty(t)){var n=s.createGraphics();n.name=e,n.id=t,s.addGraphics(n)}})}),e.$watch("ctrl.files",function(){function e(t){var e=s.getGraphicsByName(t.name);e||((e=s.createGraphics()).name=t.name);var n=c.uploads.indexOf(e);-1<n&&c.uploads.splice(n,1),c.uploads.unshift(e),t.progress=0,c.progress[e.id]=t,l(),a.upload({url:i.URL+"/project/"+r.project+"/upload/graphics",file:t,fields:{id:e.id}}).progress(function(e){t.progress=80*e.loaded/e.total}).then(function(){o(function(){t.progress=100,s.addGraphics(e)})})}if(c.files&&c.files.length)for(var t=c.files.slice(0),n=0;n<t.length;n++)e(t[n])}),e.$watch("ctrl.examService.exam.graphics",l,!0),c.insertGraphics=function(e){t.hide(e.id)},c.closeDialog=function(){t.cancel()}}]),angular.module("grademanagerApp").controller("PropertiesManagerCtrl",["$scope","$mdDialog","exam",function(e,t,n){"use strict";var o=this;o.examService=n,o.getProperties=function(){return Object.keys(o.examService.exam.properties).sort()},o.removeProperty=function(e){delete o.examService.exam.properties[e]},o.closeDialog=function(){t.cancel()}}]),angular.module("grademanagerApp").controller("ProfileCtrl",["$window","auth",function(t,n){"use strict";var o=this;o.changePassword=function(){o.error="",n.changePassword(o.oldPassword,o.password).then(function(){o.oldPassword="",o.password="",o.password2=""},function(e){o.error={error:e}})},o.addU2f=function(){n.u2fRegister(o.u2fPassword).then(function(e){o.u2ferror={error:"Please insert U2F Key!"},t.u2f.register("https://amcui.ig.he-arc.ch",[e.data.u2f],[],function(e){o.u2ferror={error:"Thank you!"},n.u2fReply(n.getUsername(),e).catch(function(e){o.u2ferror={error:e}})})},function(e){o.u2ferror={error:e.data}})},o.removeU2f=function(){n.u2fRemove().then(n.logout,function(e){o.u2ferror={error:e}})}}]),angular.module("grademanagerApp").controller("HistoryCtrl",["$state","$stateParams","$mdDialog","API",function(o,r,i,s){"use strict";var t=this;s.loadProject(r.project),s.loadHistory().then(function(e){t.logs=e.data}),t.restore=function(e,t){var n=i.confirm().targetEvent(e).title("Confirm restoring an older version!").content("Warning: Everything will be replaced! With version from "+t.date).ok("Replace").cancel("Cancel");i.show(n).then(function(){s.revertGit(t.sha).then(function(e){localStorage.setItem("import",JSON.stringify(e.data)),o.go("edit",{project:r.project},{reload:!0})})})}}]),angular.module("grademanagerApp").controller("AdminStatsCtrl",["API","$http",function(t,n){"use strict";var o=this;function r(){o.users=[],o.projects=[],o.promise=n.get(t.URL+"/admin/stats").then(function(e){return o.stats=e.data,Object.keys(o.stats.projects).forEach(function(e){var t=o.stats.projects[e];t.name=e,t.users=[],o.projects.push(t)}),o.keys(o.stats.users).forEach(function(t){o.stats.users[t].forEach(function(e){o.stats.projects[e].users.push(t)}),o.users.push({username:t,projects:o.stats.users[t].sort()})}),o.projects.forEach(function(e){e.users.sort()}),n.get(t.URL+"/admin/du").then(function(n){Object.keys(n.data).forEach(function(e){if(!o.stats.projects.hasOwnProperty(e)){var t={name:e,users:[],error:o.ERROR_NOT_IN_DB};o.stats.projects[e]=t,o.projects.push(t)}o.stats.projects[e].size=n.data[e].total,o.stats.projects[e].folders=n.data[e].folders}),o.projects.forEach(function(e){n.data.hasOwnProperty(e.name)||(e.error=o.ERROR_NO_FOLDER)})})})}o.tables={users:{order:"username",page:1,limit:10},projects:{order:"name",page:1,limit:10}},o.ERROR_NO_FOLDER="Project has no folder!",o.ERROR_NOT_IN_DB="Project not in DB!",r(),o.keys=function(e){return e?Object.keys(e):[]},o.importProject=function(e){n.post(t.URL+"/admin/import",{project:e.name}),r()},o.addToProject=function(e){n.post(t.URL+"/admin/addtoproject",{project:e.name}),r()},o.removeFromProject=function(e){n.post(t.URL+"/admin/removefromproject",{project:e.name}),r()}}]),angular.module("grademanagerApp").directive("panZoom",["$window","$timeout",function(o,e){"use strict";return{restrict:"A",link:function(t,n){t.preview.rotate=!0,e(function(){var e=svgPanZoom(n[0],{controlIconsEnabled:!0,panEnabled:!0,zoomEnabled:!0,minZoom:.5,maxZoom:10});angular.element(o).bind("resize",function(){e.resize(),e.fit(),e.center(),t.$apply()})})}}}]),function(){"use strict";wysihtml5.commands.insertCode={exec:function(e,t,n){n='<code id="code'+GUID()+'"></code>',t="insertHTML",e.commands.support(t)?e.doc.execCommand(t,!1,n):e.selection.insertHTML(n)},state:function(){return!1}}}(),angular.module("grademanagerApp").directive("myRichTextEditor",["$timeout","$mdDialog","exam",function(b,i,x){"use strict";function s(e,t){e=(e=(e=(e=(e=e.replace(/<b>\s*<\/b>/g,"")).replace(/<i>\s*<\/i>/g,"")).replace(/<tt>\s*<\/tt>/g,"")).replace(/<var>\s*<\/var>/g,"")).replace(/(<code.*?>).*?(<\/code>)/g,"$1$2");var n=document.createElement("div");n.innerHTML=e;var o,r=n.getElementsByTagName("B");for(o=0;o<r.length;o++)r[o].innerHTML=r[o].innerHTML.replace(/\r?\n/g," ");for(r=n.getElementsByTagName("I"),o=0;o<r.length;o++)r[o].innerHTML=r[o].innerHTML.replace(/\r?\n/g," ");for(r=n.getElementsByTagName("TT"),o=0;o<r.length;o++)r[o].innerHTML=r[o].innerHTML.replace(/\r?\n/g," ");return wysihtml5.dom.parse(n.innerHTML,t)}var a={77:["formatInline","tt"],76:["formatInline","var"]};return{restrict:"E",replace:!0,require:"?ngModel",transclude:!0,templateUrl:"views/myrichtexteditor.html",scope:{content:"=ngModel"},link:function(u,e,t,n){var m,h,o=e.children()[0],r=e.children()[1],g=e.children()[2],f=e.children()[3],v={};function y(){var e=g;m&&(e=m.composer.editableArea);for(var t,n=e.getElementsByTagName("img"),o=0;o<n.length;o++){var r=n[o],i=x.getGraphics(r.getAttribute("id"));i?(v.hasOwnProperty(i.id)||(v[(t=i).id]=u.$watch('examService.exam.graphics["'+t.id+'"]',function(){b(function(){y(),h&&(f.style.width=h.offsetWidth+"px")})},!0)),r.setAttribute("src",x.graphicsPreviewURL(i.id)),r.classList.toggle("border",i.border),r.classList.toggle("options",i.options),r.style.width=100*i.width+"%"):r.setAttribute("src",x.graphicsPreviewURL(""))}for(var s,a=e.getElementsByTagName("code"),c=0;c<a.length;c++){var l=a[c];l.classList.add("wysihtml5-uneditable-container");var d,p=x.getCode(l.getAttribute("id"),!0);l.classList.toggle("border",p.border),0===l.children.length?(d=CodeMirror(l,{viewportMargin:1/0,value:p.content||"\n",lineNumbers:p.numbers,mode:p.mode,readOnly:"nocursor"}),v.hasOwnProperty(p.id)||(v[(s=p).id]=u.$watch('examService.exam.codes["'+s.id+'"]',function(){b(function(){y()})},!0))):((d=l.children[0].CodeMirror).setOption("lineNumbers",p.numbers),d.setOption("mode",p.mode),d.setValue(p.content))}}u.examService=x,u.showGraphicsManager=function(e){i.show({clickOutsideToClose:!0,templateUrl:"views/graphicsmanager.html",targetEvent:e,controller:"GraphicsManagerCtrl",controllerAs:"ctrl"}).then(function(e){wysihtml5.commands.insertImage.exec(m.composer,"insertImage",{id:e}),b(y)})},u.close=function(){m&&m.currentView.element.blur()},u.cmd=function(e,t){m&&m.composer.commands.exec(e,t)},n.$render=function(){var e=n.$viewValue||"";g&&(g.innerHTML=e),m&&m.setValue(e),b(y)},g.addEventListener("click",function(){m=new wysihtml5.Editor(r,{autoLink:!1,toolbar:o,parserRules:wysihtml5ParserRules,parser:s,contentEditableMode:!0,useLineBreaks:!1,stylesheets:["styles/wysihtml5_custom.css"]}),wysihtml5.dom.observe(m.composer.editableArea,"keydown",function(e){var t=a[e.keyCode];(e.ctrlKey||e.metaKey)&&!e.altKey&&t&&(m.composer.commands.exec.apply(m.composer.commands,t),e.preventDefault())}),u.closeGraphicsToolbar=function(){f.classList.add("hide")},u.showGraphicsSettings=function(e,t){i.show({clickOutsideToClose:!1,targetEvent:e,templateUrl:"views/promptdialog.html",controller:"PromptDialogCtrl",controllerAs:"ctrl",locals:{options:{title:"Advanced options",content:"Provide LaTeX includegraphics options overrides:",label:"options",value:t.options}}}).then(function(e){t.options=e})},b(function(){m.composer.editableArea.addEventListener("click",function(e){if("IMG"===e.target.tagName){var t=e.target;f.classList.remove("hide"),f.style.top=t.offsetTop+"px",f.style.left=t.offsetLeft+"px",f.style.width=t.offsetWidth+"px",u.graphics=x.getGraphics(t.getAttribute("id")),h=t,u.$apply()}var n=function e(t){return"CODE"===t.tagName?t:t.parentElement?e(t.parentElement):void 0}(e.target);if(n){var o=x.getCode(n.getAttribute("id"));i.show({clickOutsideToClose:!1,targetEvent:e,templateUrl:"views/codeeditor.html",controller:"CodeEditorCtrl",controllerAs:"ctrl",locals:{code:o}})}})}),m.on("focus",function(){o.classList.remove("hide")}),m.on("blur",function(){o.classList.add("hide"),f.classList.add("hide")}),m.on("change",function(){b(function(){n.$setViewValue(m.getValue(!0))})}),m.on("paste",function(){b(y)}),m.on("aftercommand:composer",function(){b(y)}),m.on("change_view",function(){b(y)}),o.classList.remove("hide"),r.classList.remove("hide"),e[0].removeChild(g),g=null,m.setValue(n.$viewValue||""),b(function(){m.focus()})},!1)}}}]),angular.module("grademanagerApp").directive("myPdfViewer",function(){"use strict";return{template:'<div class="pdfViewer"></div>',restrict:"E",scope:{src:"@pdf",viewer:"="},link:function(e,t){PDFJS.disableStream=!0;var n=t[0],o=new PDFJS.PDFViewer({container:n});e.viewer=o,n.addEventListener("pagesinit",function(){o.currentScaleValue="page-width"}),n.addEventListener("scroll",function(){e.$apply()}),e.$watch("src",function(e){e&&PDFJS.getDocument(e).then(function(e){o.setDocument(e)})})}}}),angular.module("grademanagerApp").directive("stringToNumber",function(){"use strict";return{require:"ngModel",priority:1,link:function(e,t,n,o){o.$parsers.push(function(e){return""+e}),o.$formatters.push(function(e){return parseFloat(e,10)})}}}),angular.module("grademanagerApp").service("API",["$injector","$http","$timeout","$rootScope","$mdDialog","$mdToast",function(e,n,t,i,o,s){"use strict";function a(){return e.get("auth")}var c=this;c.URL="https://amcui.ig.he-arc.ch",c.SOCKET_URL="https://amcui.ig.he-arc.ch/",c.project=!1,c.options={users:[],options:{},status:{}},c.connected={},c.logs={},c.sortedLogs=[],c.projects=[],c.projectsRecent=[],c.projectsIndex={},c.getProjectList=function(){return n.get(c.URL+"/project/list").then(function(e){var t=e.data;t.sort(function(e,t){return e.project>t.project?1:-1}),c.projects=t.map(function(e){return e.short=e.project.split("-")[0],c.projectsIndex[e.project]=e}),n.get(c.URL+"/project/recent").then(function(e){var t=e.data;c.projectsRecent=[],t.forEach(function(e){c.projectsIndex.hasOwnProperty(e)&&c.projectsRecent.push(c.projectsIndex[e])})})})},c.createProject=function(e){return n.post(c.URL+"/project/create",{project:e})},c.newLog=function(e){return c.logs[e]={msg:e,log:"",err:"",progress:0,start:new Date},c.sortedLogs.unshift(c.logs[e]),c.logs[e]},c.getLog=function(e){return c.logs.hasOwnProperty(e)||c.newLog(e),c.logs[e]},c.getDownloadZipURL=function(){return c.URL+"/project/"+c.project+"/zip/pdf?token="+a().getToken()},c.getAnnotateZipURL=function(){return c.URL+"/project/"+c.project+"/zip/annotate?token="+a().getToken()},c.getStaticFileURL=function(e){return c.URL+"/project/"+c.project+"/static/"+e+"?token="+a().getToken()},c.loadTemplate=function(e){return n.post(c.URL+"/project/"+c.project+"/copy/template",{template:e})},c.loadProject=function(e){var n,o,r;c.project!==e&&(Raven&&(Raven.setUserContext({id:a().getUsername()}),Raven.setExtraContext({project:e})),c.project=e,c.PROJECT_URL=c.URL+"/project/"+c.project,c.newLog("connecting"),c.socket&&c.socket.disconnect(),c.socket=io.connect(c.SOCKET_URL+"?token="+a().getToken()),c.loadOptions(),c.socket.on("connect",function(){var e=c.getLog("connecting");e.end=new Date,e.progress=1}),c.socket.on("connect_error",function(){var e=c.getLog("connecting");e.end=new Date,e.progress=1,e.code=1,e.err="Socket connection error, retrying, check firewall.",c.options.status.locked=0,c.showProgressDialog()}),c.socket.on("reconnect_failed",function(e){s.show(s.simple().content("Error reconnecting socket!").position("top right")),console.log("socket error:",e)}),c.socket.on("user:online",function(e){c.connected=e,i.$apply()}),c.socket.on("user:connected",function(e){c.connected[e.id]=e,i.$apply()}),c.socket.on("user:disconnected",function(e){delete c.connected[e.id],i.$apply()}),c.socket.on("update:options",function(e){c.options.options=e,i.$apply()}),c.socket.on("log",function(e){if("start"===e.action?((n=c.newLog(e.msg)).command=e.command,n.params=e.params,"getimages"===e.command&&c.showProgressDialog()):n=c.getLog(e.msg),"log"===e.action){var t=/===<.*?>=\+(.*)/g.exec(e.data);t?n.progress+=parseFloat(t[1]):(n.log+=e.data+"\n","prepare"===e.command&&(n.progress+=.001),"prepare"===e.command&&(n.progress+=.01))}"err"===e.action&&(c.logs[e.msg].err+=e.data),"end"===e.action&&(n.code=e.code,n.progress=1,n.end=new Date,0<e.code&&(c.options.status.locked=0,"preview"!==e.msg&&c.showProgressDialog())),i.$apply()}),c.socket.on("print",function(e){if("start"===e.action&&(c.sortedLogs=[],c.logs={},o=new Date,c.options.status.locked=1,c.options.status.printed=void 0,c.showProgressDialog()),"end"===e.action){var t={start:o,end:new Date,command:"print",msg:"printing done",log:e.pdfs.join("\n"),progress:1};c.sortedLogs.unshift(t),c.logs["printing done"]=t,c.options.status.locked=0,c.options.status.printed=(new Date).getTime()}i.$apply()}),c.socket.on("annotate",function(e){if("start"===e.action&&(c.sortedLogs=[],c.logs={},r=new Date,c.options.status.locked=1,c.options.status.annotated=void 0,c.showProgressDialog()),"end"===e.action){var t={start:r,end:new Date,command:"print",msg:"annotating done",log:"",type:e.type,file:e.file,progress:1};c.sortedLogs.unshift(t),c.logs["annotating done"]=t,c.options.status.locked=0,c.options.status.annotated=(new Date).getTime()}i.$apply()}),c.socket.emit("listen",c.project))},c.showProgressDialog=function(){o.show({clickOutsideToClose:!1,escapeToClose:!1,hasBackdrop:!0,templateUrl:"views/progressdialog.html",controller:"ProgressDialogCtrl",controllerAs:"ctrl"})},c.loadOptions=function(){n.get(c.URL+"/project/"+c.project+"/options").then(c.handleOptions)},c.handleOptions=function(e){var t=e.data;c.options.users=t.users||[],c.options.users.sort(),c.options.options=t.options||{},c.options.status=t.status||{},0<c.options.status.locked&&c.showProgressDialog()},c.saveOptions=function(e){return e=e||c.options.options,n.post(c.URL+"/project/"+c.project+"/options",{options:e})},c.deleteGraphics=function(e){return n.post(c.URL+"/project/"+c.project+"/graphics/delete",{id:e.id,filename:e.name})},c.preview=function(e){return n.post(c.URL+"/project/"+c.project+"/preview",e)},c.print=function(e){return n.post(c.URL+"/project/"+c.project+"/print",e).catch(function(e){s.show(s.simple().content(e).position("top right"))})},c.copyProject=function(e,t){return n.post(c.URL+"/project/"+e+"/copy/project",{project:t}).catch(function(e){s.show(s.simple().content(e).position("top right"))})},c.copyGraphics=function(e,t){return n.post(c.URL+"/project/"+e+"/copy/graphics",{project:t}).catch(function(e){s.show(s.simple().content(e).position("top right"))})},c.copyCodes=function(e,t){return n.post(c.URL+"/project/"+e+"/copy/codes",{project:t}).catch(function(e){s.show(s.simple().content(e).position("top right"))})},c.deleteProject=function(){return n.post(c.URL+"/project/"+c.project+"/delete")},c.renameProject=function(e){return n.post(c.URL+"/project/"+c.project+"/rename",{name:e})},c.addUser=function(e,t){return n.post(c.URL+"/project/"+t+"/add",{username:e})},c.removeUser=function(e,t){return n.post(c.URL+"/project/"+t+"/remove",{username:e})},c.setZoneManual=function(e,t){return n.post(c.URL+"/project/"+e+"/capture/setmanual",t)},c.setPageAuto=function(e,t){return n.post(c.URL+"/project/"+e+"/capture/setauto",t)},c.loadHistory=function(){return n.get(c.URL+"/project/"+c.project+"/gitlogs")},c.revertGit=function(e){return n.post(c.URL+"/project/"+c.project+"/revert",{sha:e})}}]),angular.module("grademanagerApp").factory("authInterceptor",["$injector","$q",function(r,t){"use strict";return{request:function(e){var t=r.get("auth"),n=r.get("API"),o=t.getToken();return 0===e.url.indexOf(n.URL)&&o&&(e.headers.Authorization="Bearer "+o),e},response:function(e){var t=r.get("auth"),n=r.get("API");return 0===e.config.url.indexOf(n.URL)&&e.data.token&&t.saveToken(e.data.token),e},responseError:function(e){e&&401===e.status&&r.get("auth").logout();return t.reject(e)}}}]),angular.module("grademanagerApp").service("auth",["$window","API","$http",function(n,o,r){"use strict";var i=this;i.parseJwt=function(e){var t=e.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(n.atob(t))},i.saveToken=function(e){n.localStorage.setItem("jwtToken",e)},i.getToken=function(){return n.localStorage.getItem("jwtToken")},i.isAuthed=function(){var e=i.getToken();if(e){var t=i.parseJwt(e);return Math.round((new Date).getTime()/1e3)<=t.exp}return!1},i.getUsername=function(){var e=i.getToken();return e?i.parseJwt(e).username:""},i.getUser=function(){var e=i.getToken();return e?i.parseJwt(e):{}},i.login=function(e,t){return r.post(o.URL+"/login",{username:e,password:t})},i.u2fReply=function(e,t){return r.post(o.URL+"/login",{username:e,u2f:t})},i.u2fRegister=function(e){return r.post(o.URL+"/login",{username:i.getUsername(),password:e,u2fRegistration:!0})},i.u2fRemove=function(){return r.post(o.URL+"/profile/removeU2f",{})},i.changePassword=function(e,t){return r.post(o.URL+"/changePassword",{username:i.getUsername(),password:e,newPassword:t})},i.logout=function(){n.localStorage.removeItem("jwtToken")}}]),angular.module("grademanagerApp").service("exam",["$rootScope","$stateParams","$mdDialog","API","auth",function(o,n,t,r,i){"use strict";var l=this,s=diffsync.Client;function a(e,t,n){for(var o;null!==(o=e.exec(t));)o.index===e.lastIndex&&e.lastIndex++,n(o)}function c(e){return e=(e=(e=e.replace(/\\(?:textbf|bf){([\s\S]*?)}/g,"<b>$1</b>")).replace(/\\(?:textit|emph){([\s\S]*?)}/g,"<i>$1</i>")).replace(/\\newline/g,"<p>&nbsp;</p>")}l.preview=function(){var e=l.toLatex();e.source=l.exam.source,e.codes=l.exam.codes,r.preview(e)},l.print=function(){function e(){var e=l.toLatex();e.source=l.exam.source,e.codes=l.exam.codes,r.print(e)}r.options.status.scanned?t.show(t.confirm().title("Warning!").content("Papers analysis was already made on the basis of the current working documents. If you modify working documents, you will not be capable any more of analyzing the papers you have already distributed!").ok("Print & Overwrite").cancel("Cancel")).then(e):e()},l.load=function(e){var t=r.newLog("loading exam"),n=new s(r.socket,r.project);n.on("connected",function(){l.exam=n.getData(),e(n),t.end=new Date,t.progress=1,o.$apply()}),n.on("synced",function(){o.$apply()}),n.on("error",function(e){console.log("error",e)}),n.initialize()},l.importJSON=function(e){"string"==typeof e&&(e=JSON.parse(e)),angular.copy(e,l.exam)},l.loadTemplate=function(e){r.loadTemplate(e).then(function(e){l.exam&&(l.exam.source=e.data)})},l.newSection=function(){return{id:"s"+GUID(),title:"Add Section",content:"<p></p>",level:0,isNumbered:!0,isSectionTitleVisibleOnAMC:!0,shuffle:!1,columns:1,pageBreakBefore:!1,questions:[]}},l.getSection=function(e){for(var t=0;t<l.exam.sections.length;t++)if(l.exam.sections[t].id===e)return l.exam.sections[t]},l.addQuestion=function(e){var t;e.questions&&0<e.questions.length&&(t=e.questions[e.questions.length-1]);var n={id:"q"+GUID(),content:"<p></p>",type:"SINGLE",layout:"VERTICAL",ordered:!1,scoring:"",points:1,dots:!1,lines:3,columns:1,boxedAnswers:!1,answers:[]};return t&&(n.type=t.type,n.columns=t.columns),"OPEN"!==n.type&&(l.addAnswer(n),l.addAnswer(n)),e.questions.push(n),n},l.copyQuestion=function(e,t){var n=l.addQuestion(e);return n.content=t.content,n.type=t.type,n.layout=t.layout,n.ordered=t.ordered,n.scoring=t.scoring,n.points=t.points,n.dots=t.dots,n.lines=t.lines,n.columns=t.columns,n.boxedAnswers=t.boxedAnswers,n.answers=[],t.answers.forEach(function(e){l.copyAnswer(n,e)}),n},l.removeQuestion=function(e,t){e.questions.splice(e.questions.indexOf(t),1)},l.addAnswer=function(e){var t={id:"a"+GUID(),content:"<p></p>",correct:!1};return e.answers.push(t),t},l.copyAnswer=function(e,t){var n=l.addAnswer(e);return n.content=t.content,n.correct=t.correct,n},l.removeAnswer=function(e,t){e.answers.splice(e.answers.indexOf(t),1)},l.createGraphics=function(){return{id:"g"+GUID(),border:!1,width:.7,name:""}},l.addGraphics=function(e){l.exam.graphics||(l.exam.graphics={}),l.exam.graphics[e.id]=e},l.deleteGraphics=function(e){r.deleteGraphics(e).then(function(){delete l.exam.graphics[e.id]})},l.addCode=function(e){var t={id:e,border:!0,mode:"",numbers:!1,content:""};return l.exam.codes||(l.exam.codes={}),l.exam.codes[t.id]=t},l.getCode=function(e,t){return l.exam&&l.exam.codes&&l.exam.codes.hasOwnProperty(e)?l.exam.codes[e]:t?l.addCode(e):void 0},l.computeHierarchyNumbers=function(){for(var e=1,t=[0,0,0],n=0;n<l.exam.sections.length;n++){var o=l.exam.sections[n];if(o.isNumbered){for(var r="",i=0;i<3;i++)if(parseInt(o.level)===i&&t[i]++,0<i&&(r+="."),r+=t[i],parseInt(o.level)===i){for(var s=i+1;s<3;s++)t[s]=0;o.number=r;break}}else o.number="";for(var a=0;a<o.questions.length;a++){var c=o.questions[a];c.number=e,e++,c.isValid=("OPEN"===c.type||0<c.answers.length)&&("SINGLE"!==c.type||1===c.answers.reduce(function(e,t){return e+t.correct},0))}}},l.graphicsPreviewURL=function(e){return r.PROJECT_URL+"/static/src/graphics/"+e+"_thumb.jpg?token="+i.getToken()},l.getJSON=function(){return JSON.stringify(angular.copy(l.exam),null,2)},l.getGraphics=function(e){if(l.exam&&l.exam.graphics&&l.exam.graphics.hasOwnProperty(e))return l.exam.graphics[e]},l.getGraphicsByName=function(e){if(l.exam&&l.exam.graphics)for(var t in l.exam.graphics)if(l.exam.graphics[t].name===e)return l.exam.graphics[t]};var d={};function p(e){d={},a(/\\element{(.*?)}[\s\S]*?\\begin{(question|questionmult)}{(.*?)}([\s\S]*?)\\end{\2}/g,e,function(e){d.hasOwnProperty(e[1])||(d[e[1]]=[]);var t={id:e[3],scoring:"",points:1,answers:[]},n=e[4],o=n.match(/([\s\S]*?)\\begin{(reponses|reponseshoriz)}/);if(o){t.type="question"===e[2]?"SINGLE":"MULTIPLE",t.content=c(o[1]);var r=n.match(/\\begin{(reponses|reponseshoriz)}\[?(o?)\]?([\s\S]*)\\end{\1}/);t.layout="reponses"===r[1]?"VERTICAL":"HORIZONTAL",t.ordered="o"===r[2],a(/\\(bonne|mauvaise){([\s\S]*?)}/g,r[3],function(e){t.answers.push({id:"a"+GUID(),content:e[2],correct:"bonne"===e[1]})})}else if(o=n.match(/([\s\S]*?)\\AMCOpen/)){t.type="OPEN",t.content=c(o[1]);var i=n.match(/\\AMCOpen{(.*?)}{[\s\S]*\\bonne.*\\bareme{(\d)}/),s=i[1].match(/lines=(\d+)/);s&&(t.lines=s[1]),(s=i[1].match(/dots=(\d+)/))&&(t.dots="true"===s[1]),t.points=i[2]}d[e[1]].push(t)}),a(/AMCsection{(.*?)}([\s\S]*?)\\restituegroupe{(.*?)}/g,e,function(e){var t=l.newSection();t.title=e[1],t.level=0,t.isNumbered=!0,t.isSectionTitleVisibleOnAMC=!0,t.content=c(e[2]),t.questions=d[e[3]]||[],l.exam.sections.push(t)})}function u(e){e=e.replace(/&nbsp;/g," ");var t={"\\r\\n":" ","\\n":" ","&lt;":"<","&gt;":">","\\\\":"\\textbackslash ","&":"\\&","%":"\\%","\\$":"\\$","\\#":"\\#",_:"\\_","\\{":"\\{","\\}":"\\}","~":"\\textasciitilde ","\\^":"\\textasciicircum "};for(var n in t)if(t.hasOwnProperty(n)){var o=new RegExp(n,"g");e=e.replace(o,t[n])}return e}l.importLatex=function(e){p(e)};var m={"text/html":"html","text/css":"html","text/javascript":"JavaScript","text/x-sql":"SQL","text/x-java":"java","text/x-python":"Python"};function h(e){var t=l.getCode(e.getAttribute("id"));if(t){var n="\\lstinputlisting[",o=[];return t.border&&o.push("frame=single"),t.numbers||o.push("numbers=none"),t.mode&&m.hasOwnProperty(t.mode)&&o.push("language="+m[t.mode]),n+=o.join(",")+"]{src/codes/"+t.id+"}"}return"CODE\\_NOT\\_FOUND"}function g(e,t){var n=l.getGraphics(e.getAttribute("id"));if(n){var o="width="+n.width.toFixed(2)+"\\textwidth";n.options&&(o=n.options);var r="\\includegraphics["+o+"]{src/graphics/"+n.id+"}";return n.border&&(r="\\fbox{"+r+"}"),t&&(r="$\\vcenter{\\hbox{"+r+"}}$"),r}return"IMG\\_NOT\\_FOUND"}function f(e,a){var t=document.createElement("div");function c(e,t){for(var n=e.childNodes,o=0;o<n.length;o++)if(n[o].nodeName===t.toUpperCase())return 1}return t.innerHTML=e,function e(t,n){if(t.hasChildNodes()){for(var o=t.childNodes,r="",i=0;i<o.length;i++){var s=o[i];switch(s.nodeName){case"#text":r+=u(s.textContent);break;case"VAR":r+=" "+s.textContent+" ";break;case"B":r+="\\textbf{"+e(s,n+1)+"}";break;case"I":r+="\\emph{"+e(s,n+1)+"}";break;case"TT":r+="\\texttt{"+e(s,n+1)+"}";break;case"IMG":r+=g(s,a);break;case"CODE":r+=h(s);break;case"P":s.classList.contains("wysiwyg-text-align-center")?(r+="\\begin{center}\n",r+=e(s,n+1)+"\n",r+="\\end{center}\n"):r+=e(s,n+1),1<t.childNodes.length&&(r+="\n\n");break;case"OL":c(s,"LI")&&(r+="\\begin{enumerate}\n"+e(s,n+1)+"\\end{enumerate}\n");break;case"UL":c(s,"LI")&&(r+="\\begin{itemize}\n"+e(s,n+1)+"\\end{itemize}\n");break;case"LI":r+="\\item "+e(s,n+1)+"\n";break;case"BOX":r+="\\fbox{\\parbox{\\textwidth}{\n"+e(s,n+1)+"}}\\newline\n";break;case"HR":r+="\\newpage\n";break;case"H1":r+="\\section*{"+e(s,n+1)+"}\n";break;case"H2":r+="\\subsection*{"+e(s,n+1)+"}\n";break;case"H3":r+="\\subsubsection*{"+e(s,n+1)+"}\n"}}return r}return t.textContent}(t,0)}function v(e,t,n){var o="VERTICAL"===e.layout?"reponses":"reponseshoriz",r="  \\begin{"+t+"}{Q"+("00"+e.number).slice(-2)+"}";e.scoring&&(r+="\\scoring{"+e.scoring+"}"),n.push(r),n.push("\n  "+f(e.content));var i="\n    \\begin{"+o+"}";e.ordered&&(i+="[o]"),e.columns&&1===e.columns&&e.boxedAnswers&&n.push("\n    \\AMCBoxedAnswers"),e.columns&&1<e.columns&&n.push("\n    \\begin{multicols}{"+e.columns+"}\\AMCBoxedAnswers"),n.push(i),e.answers.forEach(function(e){var t;t=e,n.push("      \\"+(t.correct?"bonne":"mauvaise")+"{"+f(t.content,!0)+"      }")}),n.push("    \\end{"+o+"}"),e.columns&&1<e.columns&&n.push("    \\end{multicols}"),n.push("  \\end{"+t+"}")}function y(e,t,n){switch(n.push("\\element{"+e.id+"}{"),t.type){case"SINGLE":v(t,"question",n);break;case"MULTIPLE":v(t,"questionmult",n);break;case"OPEN":!function(e,t){var n="  \\begin{question}{Q"+("00"+e.number).slice(-2)+"}";t.push(n),t.push("\n  "+f(e.content)),e.lineup&&0<e.lines&&t.push("\n {\\setlength{\\fboxsep}{0pt}\\setlength{\\fboxrule}{1pt}\\fbox{\\begin{minipage}[t]["+e.lines+"cm]{\\textwidth}\\hfill\\vfill\\end{minipage}}} \n");var o="    \\AMCOpen{";o+="lines="+e.lines,e.lineup&&(o+=",lineup=true"),o+=",dots="+(e.dots?"true":"false"),o+="}{ \\hbox{\\parbox{"+(e.lineup?"5cm":"14.4cm")+"}{",t.push(o),t.push("      \\wrongchoice[0]{0pt}\\scoring{0}");for(var r=1;r<=e.points;r++){var i="wrongchoice",s=r;r===e.points&&(i="correctchoice"),t.push("      \\"+i+"["+s+"]{"+r+(1<r?"pts":"pt")+"}\\scoring{"+r+"}")}t.push("}}    }"),t.push("  \\end{question}")}(t,n)}n.push("}")}function e(){l.exam.properties||(l.exam.properties={}),(l.exam.course||l.exam.session||l.exam.teacher)&&(l.exam.properties.course=l.exam.course,l.exam.properties.session=l.exam.session,l.exam.properties.teacher=l.exam.teacher,delete l.exam.course,delete l.exam.session,delete l.exam.teacher,l.exam.source=l.exam.source.replace(/\\ACMUImatiere/g,"\\AMCUIcourse"),l.exam.source=l.exam.source.replace(/\\ACMUIsession/g,"\\AMCUIsession"),l.exam.source=l.exam.source.replace(/\\ACMUIteacher/g,"\\AMCUIteacher"));for(var e=/\\AMCUI([\w]+)/g,t=e.exec(l.exam.source);null!==t;){var n=t[1];l.exam.properties.hasOwnProperty(n)||(l.exam.properties[n]=""),t=e.exec(l.exam.source)}}function b(e,t){var n=[];t=t.replace(/<img id="(.*?)">/g,function(e,t){return n.push(t),'<img src="@@PLUGINFILE@@/'+t+'" alt="" role="presentation" class="img-responsive atto_image_button_text-bottom">'}),e.push("<text><![CDATA["+t+"]]></text>"),n.forEach(function(t){e.push(fetch(l.graphicsPreviewURL(t)).then(function(e){return e.body.getReader().read().then(function(e){return btoa(String.fromCharCode.apply(null,e.value))}).then(function(e){return'<file name="'+t+'" path="/" encoding="base64">'+e+"</file>"})}))})}function x(e,t,n){e.push('    <answer fraction="'+(t.correct?n:"0")+'" format="html">'),b(e,t.content),e.push('      <feedback format="html"><text></text></feedback>'),e.push("    </answer>")}l.toLatex=function(){var t=[],n=[];return l.exam&&l.exam.sections&&(e(),Object.keys(l.exam.properties).forEach(function(e){t.push("\\newcommand{\\AMCUI"+e+"}{"+f(l.exam.properties[e]||"")+"}")}),l.exam.sections.forEach(function(e){!function(t,n,o){if(t.questions.forEach(function(e){y(t,e,n)}),t.pageBreakBefore&&o.push("\\newpage"),""!==t.title){var e="\n\\";t.isSectionTitleVisibleOnAMC&&(e+="AMC"),e+=new Array(parseInt(t.level)+1).join("sub")+"section",t.isNumbered||(e+="*"),e+="{"+f(t.title)+"}\n",o.push(e)}if(o.push(f(t.content)),0<t.questions.length){t.shuffle&&o.push("\\melangegroupe{"+t.id+"}");var r=function(e){e()};1<t.columns&&(r=function(e){o.push("\\begin{multicols}{"+t.columns+"}"),e(),o.push("\\end{multicols}")}),r(function(){t.content&&0<t.content.length&&"<p></p>"!==t.content&&o.push("\\vspace{\\baselineskip}"),o.push("\\restituegroupe{"+t.id+"}")})}}(e,t,n)})),{questions_definition:t.join("\n"),questions_layout:n.join("\n"),json:l.getJSON()}},l.toMoodleQuiz=function(){var t=['<?xml version="1.0" encoding="UTF-8"?>',"<quiz>"];return l.exam&&l.exam.sections&&l.exam.sections.forEach(function(e){t.push('  <question type="category">'),t.push("    <category>"),t.push("      <text><![CDATA[$course$/AMCUI/"+n.project+"/"+e.title+"]]></text>"),t.push("    </category>"),t.push("  </question>"),e.content&&(t.push('  <question type="description"><name><text>Description</text></name><questiontext format="html">'),b(t,e.content),t.push('  </questiontext><generalfeedback format="html"><text></text></generalfeedback><defaultgrade>0.0000000</defaultgrade><penalty>0.0000000</penalty><hidden>0</hidden></question>')),e.questions.forEach(function(e){!function(t,e){if(t.push('  <question type="'+("OPEN"===e.type?"essay":"multichoice")+'">'),t.push("    <name>"),t.push("      <text>Q"+("00"+e.number).slice(-2)+"</text>"),t.push("    </name>"),t.push('    <questiontext format="html">'),b(t,e.content),t.push("    </questiontext>"),t.push('    <generalfeedback format="html"><text></text></generalfeedback><hidden>0</hidden>'),"SINGLE"===e.type||"MULTIPLE"===e.type){t.push("    <defaultgrade>1.0000000</defaultgrade>"),t.push("    <single>"+("SINGLE"===e.type?"true":"false")+"</single>"),t.push("    <penalty>0.3333333</penalty><shuffleanswers>true</shuffleanswers><answernumbering>abc</answernumbering>");var n=100/e.answers.filter(function(e){return e.correct}).length;e.answers.forEach(function(e){x(t,e,n)}),"MULTIPLE"===e.type&&x(t,{content:"Aucune des rponses",correct:n==1/0},100)}"OPEN"===e.type&&(t.push("    <defaultgrade>"+e.points+"</defaultgrade>"),t.push("    <responseformat>editor</responseformat><responserequired>1</responserequired><responsefieldlines>15</responsefieldlines><attachments>0</attachments><attachmentsrequired>0</attachmentsrequired>"),t.push('    <graderinfo format="html"><text></text></graderinfo><responsetemplate format="html"><text></text></responsetemplate>')),t.push("  </question>")}(t,e)})}),t.push("</quiz>"),Promise.all(t).then(function(t){o.$apply(function(){var e=window.document.createElement("a");e.href=window.URL.createObjectURL(new Blob([t.join("\n")],{type:"text/xml"})),e.download=n.project+"_moodle.xml",document.body.appendChild(e),e.click(),document.body.removeChild(e)})})}}]),angular.module("grademanagerApp").filter("htmlToPlaintext",function(){"use strict";return function(e){return String(e).replace(/<[^>]+>/gm,"").replace(/&nbsp;/gm," ")}}),angular.module("grademanagerApp").filter("join",function(){"use strict";return function(e,t){return angular.isArray(e)?e.join(t):e}}),angular.module("grademanagerApp").filter("unique",function(){"use strict";return function(e,t){if(!1===t)return e;if((t||angular.isUndefined(t))&&angular.isArray(e)){var o=[],r=function(e){return angular.isObject(e)&&angular.isString(t)?e[t]:e};angular.forEach(e,function(e){for(var t=!1,n=0;n<o.length;n++)if(angular.equals(r(o[n]),r(e))){t=!0;break}t||o.push(e)}),e=o}return e}}),angular.module("grademanagerApp").run(["$templateCache",function(e){"use strict";e.put("views/admin/stats.html",'<md-tabs md-dynamic-height> <md-tab label="Projects"> <md-content> <md-card> <md-toolbar class="md-table-toolbar md-accent"> <div class="md-toolbar-tools"> <span>Projects ({{ctrl.projects.length}})</span> </div> </md-toolbar> <md-table-container> <table md-table md-progress="ctrl.promise"> <thead md-head md-order="ctrl.tables.projects.order"> <tr md-row> <th md-column md-order-by="name"><span>Name</span></th> <th md-column md-numeric md-order-by="size" style="width:200px"><span>Size (Mb)</span></th> <th md-column md-numeric md-order-by="commits"><span>Commits</span></th> <th md-column md-numeric md-order-by="students"><span>Students</span></th> <th md-column md-numeric md-order-by="users.length"><span>Nb</span></th> <th md-column>Users</th> </tr> </thead> <tbody md-body> <tr ng-class="{\'admin-error\': p.error}" md-row ng-repeat="p in ctrl.projects | orderBy: ctrl.tables.projects.order | limitTo : ctrl.tables.projects.limit : ctrl.tables.projects.limit * (ctrl.tables.projects.page-1)"> <td md-cell>{{p.name}}</td> <td md-cell ng-click="p.detail = !p.detail">{{p.size/1024 | number:1}} <div ng-if="p.detail" layout="column"> <div ng-repeat="f in p.folders"> <div ng-repeat="(k,v) in f" layout="row"> <span flex style="text-align:left;">{{k}}</span> <span>{{v/1024 | number:1}}</span> </div> </div> </div> <span ng-if="p.error == ctrl.ERROR_NO_FOLDER">{{ctrl.ERROR_NO_FOLDER}}</span> </td> <td md-cell>{{p.commits}}</td> <td md-cell>{{p.students}}</td> <td md-cell>{{p.users.length}}</td> <td md-cell><span ng-repeat="u in p.users">{{u}}<span ng-hide="$last">, </span></span> <span ng-if="p.error == ctrl.ERROR_NOT_IN_DB">{{ctrl.ERROR_NOT_IN_DB}} <md-button ng-click="ctrl.importProject(p)">Import</md-button> </span> <md-button ng-if="p.users.indexOf(app.getUsername()) < 0" ng-click="ctrl.addToProject(p)">add self</md-button> <md-button ng-if="p.users.indexOf(app.getUsername()) > -1" ng-click="ctrl.removeFromProject(p)">remove self</md-button> </td> </tr> </tbody> </table> </md-table-container> <md-table-pagination md-limit="ctrl.tables.projects.limit" md-limit-options="[10, 50, 100]" md-page="ctrl.tables.projects.page" md-total="{{ctrl.projects.length}}" md-page-select></md-table-pagination> </md-card> </md-content> </md-tab> <md-tab label="Users"> <md-content> <md-card> <md-toolbar class="md-table-toolbar md-accent"> <div class="md-toolbar-tools"> <span>Users ({{ctrl.users.length}})</span> </div> </md-toolbar> <md-table-container> <table md-table md-progress="ctrl.promise"> <thead md-head md-order="ctrl.tables.users.order"> <tr md-row> <th md-column md-order-by="username"><span>Username</span></th> <th md-column md-numeric md-order-by="projects.length"><span>Nb</span></th> <th md-column>Projects</th> </tr> </thead> <tbody md-body> <tr md-row ng-repeat="u in ctrl.users | orderBy: ctrl.tables.users.order | limitTo : ctrl.tables.users.limit : ctrl.tables.users.limit * (ctrl.tables.users.page-1)"> <td md-cell>{{u.username}}</td> <td md-cell>{{u.projects.length}}</td> <td md-cell><span ng-repeat="p in u.projects">{{p}}<span ng-hide="$last">, </span></span></td> </tr> </tbody> </table> </md-table-container> <md-table-pagination md-limit="ctrl.tables.users.limit" md-limit-options="[10, 50, 100]" md-page="ctrl.tables.users.page" md-total="{{ctrl.users.length}}" md-page-select></md-table-pagination> </md-card> </md-content> </md-tab> </md-tabs>'),e.put("views/association.html",'<md-dialog aria-label="Manual association"> <form> <md-toolbar> <div class="md-toolbar-tools"> <h2>Manual Association</h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div ng-show="ctrl.match"> <img ng-src="{{ctrl.nameSrc()}}"> <md-autocomplete placeholder="Student name" md-no-cache="true" md-selected-item-change="ctrl.selectedItemChange(item)" md-search-text="ctrl.searchText" md-item-text="item.name" md-items="item in ctrl.students.data.filter(ctrl.filterUnmatched) | filter: ctrl.searchText" md-item-text="item.display"> <md-item-template> <span md-highlight-text="ctrl.searchText" md-highlight-flags="^i">{{item.name}}</span> </md-item-template> <md-not-found> No matches found for "{{ctrl.searchText}}". </md-not-found> </md-autocomplete> <p class="md-caption">Unmatched: {{ctrl.unmatchedRemaining}}</p> </div> <div ng-hide="ctrl.match"> Everything has a match. </div> </md-dialog-content> <md-dialog-actions layout="row"> <md-button ng-click="ctrl.skip()"> skip </md-button> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </md-dialog-actions> </form></md-dialog>'),e.put("views/codeeditor.html",'<md-dialog aria-label="code editor" class="code-editor" flex="80"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Code editing</h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content layout="column"> <div layout="row" layout-align="start center" class="section-options" layout-wrap> <md-select placeholder="Mode" ng-model="ctrl.code.mode" class="md-primary"> <md-option ng-repeat="mode in [\'text/html\', \'text/css\', \'text/javascript\', \'text/x-sql\', \'text/x-java\', \'text/x-python\']" value="{{mode}}">{{mode}}</md-option> </md-select> <md-checkbox class="md-primary" ng-model="ctrl.code.numbers">Line numbers</md-checkbox> <md-checkbox class="md-primary" ng-model="ctrl.code.border">Border</md-checkbox> </div> <md-content flex ng-class="{\'border\': ctrl.code.border}" layout="column"> <ui-codemirror flex ng-if="ctrl.load" ui-codemirror-opts="ctrl.options()" ng-model="ctrl.code.content"></ui-codemirror> </md-content> </md-dialog-content> <md-dialog-actions layout="row"> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </md-dialog-actions> </md-dialog> '),e.put("views/edit.html",'<div ng-if="!editor.section" flex layout-align="start center" layout="column"> <h1>Loading...</h1> <md-progress-linear md-mode="indeterminate"></md-progress-linear> </div> <div layout="row" flex class="no-background" ng-if="editor.section"> <md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-md\')" layout="column"> <md-toolbar class="md-accent md-whiteframe-z1" layout="row"> <div class="md-toolbar-tools"> <h3>Navigation</h3> </div> </md-toolbar> <div flex class="scroll-frame" du-scroll-container="main-content"> <md-content class="scroll-section"> <div class="section-options" hide-gt-xs layout-padding> <md-button aria-label="print" class="md-warn" ng-click="editor.examService.print()">Print</md-button> </div> <div ui-tree="editor.examMenuOptions"> <ol ui-tree-nodes="" ng-model="editor.examService.exam.sections" data-type="section"> <li class="section-menu" ng-repeat="section in editor.examService.exam.sections track by section.id" ng:init="parentIndex = $index" ui-tree-node ng-class="{\'active\': section == editor.section}"> <a layout="row" ng-href="{{editor.linkToQuestion(section)}}"> <p ng-if="editor.copyMode"> <md-checkbox ng-model="editor.copyCheckbox[section.id]" ng-change="editor.toggleCopy(section)" class="md-primary" data-nodrag>{{section.number}} {{section.title}}</md-checkbox> </p> <p ng-if="!editor.copyMode">{{section.number}} {{section.title}}</p> <span flex></span> <md-icon class="mdi-cursor-move" ui-tree-handle></md-icon> </a> <ol ui-tree-nodes="" ng-model="section.questions" data-type="question"> <li class="question-menu" ng-repeat="question in section.questions track by question.id" ui-tree-node du-scrollspy="q{{question.number}}"> <a ng-href="{{editor.linkToQuestion(section, question)}}" layout="row"> <div flex layout="column" class="question-menu-description"> <strong> <md-checkbox ng-model="editor.copyCheckbox[question.id]" ng-change="editor.toggleCopy(section, question)" ng-if="editor.copyMode" class="md-primary" data-nodrag> <md-icon class="mdi-alert invalid" ng-hide="question.isValid"></md-icon> Question {{question.number}} <span ng-show="question.type == \'MULTIPLE\'"></span> </md-checkbox> <div ng-if="!editor.copyMode"><md-icon class="mdi-alert invalid" ng-hide="question.isValid"></md-icon> Question {{question.number}} <span ng-show="question.type == \'MULTIPLE\'"></span></div> </strong> <em>{{question.content | htmlToPlaintext | limitTo: 50}}</em> </div> <md-icon class="mdi-cursor-move" ui-tree-handle></md-icon> </a> </li> </ol> </li> </ol> </div> <md-divider></md-divider> <div> <md-switch class="md-primary" ng-model="editor.copyMode" ng-change="editor.API.getProjectList()" aria-label="copy mode"> Activate copy </md-switch> <div ng-if="editor.copyMode"> <p>{{editor.copySummary().questions}} question(s) in {{editor.copySummary().sections}} section(s).</p> <p layout="row" layout-align="start center" layout-wrap> <md-select class="md-primary" placeholder="CopyTo" ng-model="editor.copyToName"> <md-option ng-repeat="item in editor.API.projects" value="{{item.project}}">{{item.project}}</md-option> </md-select> <md-button ng-click="editor.copyTo()" class="md-primary" ng-disabled="editor.copySummary().sections == 0 || !editor.copyTo">Copy</md-button> </p> </div> </div> </md-content> </div> </md-sidenav> <div flex class="no-background" layout="column" ng-if="editor.section"> <div ng-if="app.api.options.status.printed && !editor.hidePrintNotification" class="printed-bar" layout-padding layout="row" layout-align="center center"> This project has been printed on {{app.api.options.status.printed | date: \'yyyy-MM-dd HH:mm\'}}. <md-button class="md-raised md-primary" ng-href="{{app.api.getDownloadZipURL()}}">Download <small>(Zip with all PDFs)</small></md-button> <md-button class="md-raised md-primary" ng-click="editor.examService.toMoodleQuiz()">export moodle xml</md-button> <span flex></span> <md-button class="md-icon-button" ng-click="editor.hidePrintNotification=true" aria-label="close message"> <md-icon class="mdi-close"></md-icon> </md-button> </div> <div ng-if="!editor.examService.exam.source" class="printed-bar" layout-padding layout="row" layout-align="center center"> This project\'s templace file is empty! Select a template: <md-select class="md-primary" placeholder="Template" ng-model="editor.chooseTemplate"> <md-option ng-repeat="name in [\'HEG-QCM\', \'HEG-OPEN\', \'HEC-QCM\']" value="{{name}}">{{name}}</md-option> </md-select> <md-button class="md-raised md-primary" ng-click="editor.examService.loadTemplate(editor.chooseTemplate)">Load</md-button> <span flex></span> </div> <md-content class="section-options main-toolbar md-whiteframe-z1 no-error-input-container" layout="row" layout-align="start center" layout-padding> <md-button aria-label="toggle menu" class="md-icon-button" ng-hide="editor.leftNav().isLockedOpen()" ng-click="editor.leftNav().open()"> <md-icon class="mdi-menu"></md-icon> </md-button> <md-button class="md-primary" hide-xs ng-click="editor.showPropertiesManager($event)">Document properties</md-button> <md-input-container> <label>Search <span ng-show="editor.searchQuery">{{ editor.searchResults.length }} rsults</span></label> <input type="text" ng-change="editor.search()" ng-model="editor.searchQuery" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }"> </md-input-container> <span flex></span> <span hide-xs>{{editor.lastPreview | date: \'HH:mm:ss\'}}</span> <md-button aria-label="preview" ng-class="{\'md-warn\':  app.api.logs.preview.code>0}" ng-click="editor.showPreviewDialog($event)">{{editor.previewWait ? \'wait\' : app.api.logs.preview.code == 0 ? \'Preview\' : app.api.logs.preview.code > 0 ? \'error\' : \'compiling\'}}</md-button> <md-button aria-label="LaTeX options" class="md-primary" ng-class="{\'active\': editor.isLatexOptionVisible}" ng-click="editor.isLatexOptionVisible = !editor.isLatexOptionVisible">LaTeX options</md-button> <md-button aria-label="print" class="md-warn" ng-click="editor.examService.print()" hide-xs>Print</md-button> </md-content> <div flex ng-if="editor.isLatexOptionVisible" layout="column" class="scroll-frame"> <md-tabs flex id="latex-options" md-selected="editor.selectedSourcePreview"> <md-tab label="source.tex"> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 0" ui-codemirror-opts="editor.latexSourceOptions" ng-model="editor.examService.exam.source"></ui-codemirror> </md-tab> <md-tab> <md-tab-label> <md-icon class="mdi-lock"></md-icon> questions_definition.tex </md-tab-label> <md-tab-body> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 1" ui-codemirror-opts="editor.latexPreviewOptions" ng-model="editor.examService.toLatex().questions_definition"></ui-codemirror> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon class="mdi-lock"></md-icon> questions_layout.tex </md-tab-label> <md-tab-body> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 2" ui-codemirror-opts="editor.latexPreviewOptions" ng-model="editor.examService.toLatex().questions_layout"></ui-codemirror> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon class="mdi-lock"></md-icon> data.json </md-tab-label> <md-tab-body> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 3" ui-codemirror-opts="editor.jsonPreviewOptions" ng-init="json = editor.examService.getJSON()" ng-model="json"></ui-codemirror> </md-tab-body> </md-tab> <md-tab> <md-tab-label> import </md-tab-label> <md-tab-body> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 4" ui-codemirror-opts="editor.latexSourceOptions" ng-model="editor.importSource"></ui-codemirror> <div layout-padding> Past AMC Latex code here (amcui layout and question definition), then <md-button ng-click="editor.examService.importLatex(editor.importSource)" class="md-raised md-primary">Import</md-button> </div> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 4" ui-codemirror-opts="editor.jsonImportOptions" ng-model="editor.importJSONSource"></ui-codemirror> <div layout-padding> Past a valid JSON sync object code here to overwrite current (You can loose everything!). <md-button ng-click="editor.examService.importJSON(editor.importJSONSource)" class="md-raised md-warn">DANGER! overwrite!</md-button> </div> </md-tab-body> </md-tab> </md-tabs> <md-button aria-label="close" class="tab-close md-icon-button" ng-click="editor.isLatexOptionVisible = false"> <md-icon class="mdi-close"></md-icon> </md-button> </div> <div flex class="scroll-frame" ng-hide="editor.isLatexOptionVisible"> <md-content id="main-content" class="section scroll-section"> <md-subheader ng-if="editor.searchResults.length > 0" class="search-result md-whiteframe-z1"> <div> <md-button style="float:right" class="md-icon-button" ng-click="editor.searchQuery=\'\';editor.searchResults=[];" aria-label="close message"> <md-icon class="mdi-close"></md-icon> </md-button> <div ng-repeat="r in editor.searchResults"> <div ng-repeat="(s, obj1) in r.chain"> <b>{{editor.examService.exam.sections[s].number}} {{editor.examService.exam.sections[s].title}}</b> <span ng-if="obj1.title"><b>: </b><a ng-href="{{editor.linkToQuestion(editor.examService.exam.sections[s])}}">{{editor.highlightSearch(obj1.title) | htmlToPlaintext}}</a></span> <span ng-if="obj1.content"><b>: </b><a ng-href="{{editor.linkToQuestion(editor.examService.exam.sections[s])}}">{{editor.highlightSearch(obj1.content) | htmlToPlaintext}}</a></span> <span ng-repeat="(q, obj2) in obj1.questions"> <b>> Question {{editor.examService.exam.sections[s].questions[q].number}}</b> <span ng-if="obj2.content"><b>: </b><a ng-href="{{editor.linkToQuestion(editor.examService.exam.sections[s], editor.examService.exam.sections[s].questions[q])}}">{{editor.highlightSearch(obj2.content) | htmlToPlaintext}}</a></span> <span ng-repeat="(a, obj3) in obj2.answers"><b>> Answer:</b> <a ng-href="{{editor.linkToQuestion(editor.examService.exam.sections[s], editor.examService.exam.sections[s].questions[q])}}">{{editor.highlightSearch(obj3.content) | htmlToPlaintext}}</a></span> </span> </div> </div> </div> </md-subheader> <div class="page-width-limit"> <div class="md-whiteframe-z1"> <div class="md-whiteframe-z1" id="q0"> <div layout="row" class="section-header no-error-input-container" layout-align="space-around center"> <md-button aria-label="previous" class="md-primary" ng-show="editor.previousSection()" ng-click="editor.section = editor.previousSection()" ng-bind="editor.previousSection().title"></md-button> <span flex="20" ng-hide="editor.previousSection()"></span> <h3>{{editor.section.number}}</h3> <md-input-container md-no-float class="md-block" flex> <input type="text" ng-model="editor.section.title" placeholder="Section title"> </md-input-container> <md-button aria-label="next or new" class="md-primary" ng-click="editor.section = editor.nextSection(true)" ng-bind="editor.nextSection().title"></md-button> </div> <md-content layout="row" class="section-options section-nowrap" layout-align="start center"> <md-select class="md-primary" placeholder="Level" ng-model="editor.section.level"> <md-option ng-repeat="(key, value) in {\'Level 1\': 0, \'Level 2\': 1, \'Level 3\': 2}" value="{{value}}">{{key}}</md-option> </md-select> <md-checkbox class="md-primary" ng-model="editor.section.isNumbered" ng-disabled="editor.section.isSectionTitleVisibleOnAMC">Show number</md-checkbox> <md-checkbox class="md-primary" ng-model="editor.section.isSectionTitleVisibleOnAMC" ng-change="editor.section.isSectionTitleVisibleOnAMC ? editor.section.isNumbered=true : \'\'">On answer sheet</md-checkbox> <md-checkbox class="md-primary" ng-model="editor.section.shuffle">Shuffle</md-checkbox> <md-select class="md-primary" placeholder="Columns" ng-model="editor.section.columns"> <md-option ng-repeat="(key, value) in {\'One column\': 1, \'Two columns\': 2}" value="{{value}}">{{key}}</md-option> </md-select> <md-checkbox class="md-primary" ng-model="editor.section.pageBreakBefore">Page break before</md-checkbox> <span flex></span> <md-button aria-label="delete section" class="md-warn" ng-click="editor.removeSection(editor.section)"> <md-icon class="mdi-delete"></md-icon> </md-button> </md-content> </div> <my-rich-text-editor ng-class="{\'empty\': editor.section.content == \'\' || editor.section.content == \'<p></p>\'}" class="page-width-limit" ng-model="editor.section.content"></my-rich-text-editor> </div> <div ng-class="{\'two-columns\': editor.section.columns == 2}"> <div class="question md-whiteframe-z1 {{question.type}}" ng-repeat="question in editor.section.questions track by question.id"> <div> <div class="question-header" layout="row" layout-padding> <h3 id="q{{question.number}}"> <md-icon class="mdi-alert invalid" ng-hide="question.isValid" title="Need answers"></md-icon> Question {{question.number}} <span ng-show="question.type == \'MULTIPLE\'"></span></h3> </div> <md-content layout="row" class="section-options section-nowrap md-whiteframe-z1 no-error-input-container fix-input" layout-align="start center"> <md-select placeholder="Type" ng-model="question.type"> <md-option ng-repeat="value in [\'SINGLE\', \'MULTIPLE\', \'OPEN\']" value="{{value}}">{{value}}</md-option> </md-select> <md-select ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" placeholder="Layout" ng-model="question.layout"> <md-option ng-repeat="(key, value) in {\'VERTICAL\': \'VERTICAL\', \'HORIZONTAL\': \'HORIZONTAL\'}" value="{{value}}">{{key}}</md-option> </md-select> <md-checkbox ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" class="md-primary" ng-model="question.ordered">Ordered</md-checkbox> <md-select ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" placeholder="columns" ng-model="question.columns"> <md-option ng-repeat="(key, value) in {\'1 column\': 1, \'2 columns\': 2, \'3 columns\': 3}" value="{{value}}">{{key}}</md-option> </md-select> <md-checkbox ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" class="md-primary" ng-model="question.boxedAnswers" title="use AMCBoxedAnswers">Boxed</md-checkbox> <md-input-container class="question-scoring" ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'"> <label>scoring</label> <input ng-model="question.scoring"> </md-input-container> <md-button aria-label="scoring help" ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" class="md-primary md-icon-button" href="https://www.auto-multiple-choice.net/auto-multiple-choice.en/graphical-interface.shtml#bareme" target="_blank"> <md-icon class="mdi-help-circle"></md-icon> </md-button> <md-checkbox ng-if="question.type == \'OPEN\'" class="md-primary" ng-model="question.dots">Dots</md-checkbox> <md-checkbox ng-if="question.type == \'OPEN\'" class="md-primary" ng-model="question.lineup" title="If true, the answering area and the scoring boxes will be on the same line.\nIf false (this is default), the answering area is enclosed in a frame and placed below the scoring boxes.\nUsed for open questions and separate answer sheet)">Lineup</md-checkbox> <md-input-container ng-if="question.type == \'OPEN\'"> <label>lines</label> <input ng-model="question.lines" type="number" min="0"> </md-input-container> <md-input-container ng-if="question.type == \'OPEN\'"> <label>Points</label> <input ng-model="question.points" type="number" min="1"> </md-input-container> <md-button title="copy question" aria-label="copy question" class="md-primary md-icon-button" ng-click="editor.examService.copyQuestion(editor.section, question)"> <md-icon class="mdi-content-copy"></md-icon> </md-button> <span flex></span> <md-button aria-label="delete question" class="md-warn" ng-click="editor.examService.removeQuestion(editor.section, question)"> <md-icon class="mdi-delete"></md-icon> </md-button> </md-content> </div> <my-rich-text-editor ng-model="question.content"></my-rich-text-editor> <div ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" layout="{{question.layout == \'HORIZONTAL\' ? \'row\' : \'column\'}}" layout-padding layout-align="{{question.layout == \'HORIZONTAL\' ? \'center start\' : \'\'}}" ng-class="{\'answer-horizontal\': question.layout == \'HORIZONTAL\'}" class="answer-box"> <div ng-repeat="answer in question.answers track by answer.id" class="answer" layout="row"> <md-checkbox ng-model="answer.correct" class="answer-toggle" ng-class="{\'mdi-close\': !answer.correct, \'mdi-check\': answer.correct}" aria-label="question correct"></md-checkbox> <my-rich-text-editor ng-model="answer.content" flex></my-rich-text-editor> <md-button aria-label="delete answer" class="md-warn" ng-click="editor.examService.removeAnswer(question, answer)"> <md-icon class="mdi-delete"></md-icon> </md-button> </div> <div class="answer" layout="row" ng-if="question.type == \'MULTIPLE\'"> <md-checkbox class="answer-toggle" ng-class="{\'mdi-close\': !editor.questionIsNoneCorrect(question), \'mdi-check\': editor.questionIsNoneCorrect(question)}" aria-label="question correct"></md-checkbox> <div flex layout-padding class="myrichtexteditor answer-none">None of the above</div> <md-button aria-label="delete answer" class="md-warn" ng-disabled="\'true\'"> <md-icon class="mdi-delete"></md-icon> </md-button> </div> </div> <div ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" class="section-options answer-add"> <md-button aria-label="add new answer" class="md-primary" ng-click="editor.examService.addAnswer(question)">Add Answer</md-button> </div> <div ng-if="question.type == \'OPEN\'" layout="row" layout-align="end center" class="answer-open-points"> <div class="circle" ng-class="{\'last\': $last}" ng-repeat-start="p in editor.range(1 + question.points) track by $index"></div> <div class="point" ng-repeat-end>{{$index}}{{$index > 1 ? \'pts\' : \'pt\'}}</div> </div> <div ng-if="question.type == \'OPEN\'" class="answer-open"> <p ng-class="{\'dots\': question.dots}" ng-repeat="p in editor.range(question.lines) track by $index">&nbsp;</p> </div> </div> </div> <div class="section-options md-whiteframe-z1 question-add"> <md-button aria-label="add new question" class="md-primary" ng-click="editor.examService.addQuestion(editor.section)">Add Question</md-button> </div> </div> </md-content> </div> </div> </div>'),e.put("views/edit.preview.html",'<md-dialog aria-label="Preview Document" class="edit-preview"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Preview Document</h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content flex layout="column"> <object style="width: 819px;height: 1158px;" ng-if="!isLogVisible && ctrl.api.logs.preview.code == 0 && ctrl.api.options.options.native_preview == 1" ng-attr-data="{{ctrl.previewSrc()}}" type="application/pdf"> <p>Your browser does not support PDFs. Download the PDF below or do not use native preview.</p> </object> <my-pdf-viewer ng-if="!isLogVisible && ctrl.api.logs.preview.code == 0 && ctrl.api.options.options.native_preview != 1" pdf="{{ctrl.previewSrc()}}" viewer="ctrl.pdfViewer" flex></my-pdf-viewer> <div class="latex-errors" ng-if="isLogVisible || ctrl.api.logs.preview.code != 0"> <div layout-padding> <h3>Error</h3> <div class="err" ng-repeat="err in ctrl.getErr() | unique">{{err}}</div> <h3>Warning</h3> <div class="warn" ng-repeat="err in ctrl.getWarn() | unique">{{err}}</div> <h3>Over/Underfull</h3> <div class="full" ng-repeat="err in ctrl.getFull() | unique">{{err}}</div> </div> <ui-codemirror ui-codemirror-opts="ctrl.logOptions" ng-model="ctrl.api.logs.preview.log"></ui-codemirror> </div> </md-dialog-content> <md-dialog-actions layout="row"> <span ng-if="ctrl.api.logs.preview.code == 0 && ctrl.api.options.options.native_preview != 1">{{ctrl.pdfViewer.currentPageNumber}} / {{ctrl.pdfViewer.pagesCount}}</span> <md-button class="md-primary" ng-if="ctrl.api.logs.preview.code == 0" ng-href="{{ctrl.previewSrc()}}">download</md-button> <md-button ng-click="isLogVisible = !isLogVisible">log</md-button> <md-switch class="md-primary" ng-model="ctrl.api.options.options.native_preview" ng-true-value="\'1\'" ng-false-value="\'0\'" aria-label="use native preview"> use native preview </md-switch> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </md-dialog-actions> </md-dialog>'),e.put("views/grade.html",'\x3c!--\nThere must be at least one column named name or surname.\n\n%S\nis replaced by the student\'s total score.\n%M\nis replaced by the maximum total score.\n%s\nis replaced by the student\'s mark.\n%m\nis replaced by the maximum mark.\n%(ID)\nis replaced by the student\'s name.\n%(COL)\nis replaced by the value of column COL in the students list for the curent student.\n\nhighlight impossible? missing? confirm reviewed\n--\x3e <div class="no-background" flex layout="column"> <div ng-if="app.api.options.status.annotated && !grade.hidePrintNotification" class="printed-bar" layout-padding layout="row" layout-align="center center"> This project has been annotaed on {{app.api.options.status.annotated | date: \'yyyy-MM-dd HH:mm\'}}. <md-button class="md-raised md-primary" ng-href="{{app.api.getAnnotateZipURL()}}">Download <small>(Zip with annotated PDFs)</small></md-button> <span flex></span> <md-button class="md-icon-button" ng-click="grade.hidePrintNotification=true" aria-label="close message"><md-icon class="mdi-close"></md-icon></md-button> </div> <div class="section-options" layout-padding layout="column" style="position: relative"> <md-input-container class="no-error-input-container" style="max-height:400px;overflow:auto;" ng-hide="grade.hideAdd"> <label>Paste CSV data or drop a file</label> <textarea ng-model="grade.pasteData" id="dropbox"></textarea> </md-input-container> <div layout="row" class="no-padding" ng-hide="grade.hideAdd"> <md-button class="md-primary" ng-click="grade.parsePasteData()">Add to Students</md-button> <md-button class="md-primary" ng-click="grade.parseAsNewFile()">Add as new file</md-button> <span flex></span> <md-button class="md-warn" ng-click="grade.export()">export</md-button> </div> <md-button ng-show="grade.hideAdd" ng-click="grade.hideAdd = !grade.hideAdd">CSV Options</md-button> <md-button ng-hide="grade.hideAdd" ng-click="grade.hideAdd = !grade.hideAdd" aria-label="close" class="md-icon-button tab-close"><md-icon class="mdi-close"></md-icon></md-button> </div> <md-progress-linear ng-if="grade.isLoading" md-mode="indeterminate"></md-progress-linear> <md-tabs flex md-selected="grade.tabIndex" ng-if="!grade.isLoading"> <md-tab label="Students"> <section class="grades"> <div ng-if="grade.students.data.length > 0 && grade.table"> <h4>Datatable</h4> <table> <tr> <th></th> <th class="text-right" ng-repeat="c in grade.table[0] track by $index">{{c | number: 0}}</th> </tr> <tr> <th class="text-left">AVG</th> <td class="text-right" ng-repeat="c in grade.table[1] track by $index">{{c | number: 2}}</td> </tr> <tr> <th class="text-left">Pass</th> <td class="text-right" ng-repeat="c in grade.table[2] track by $index">{{c | number: 0}}%</td> </tr> <tr> <th class="text-left">Remed</th> <td class="text-right" ng-repeat="c in grade.table[3] track by $index">{{c | number: 0}}%</td> </tr> <tr> <th class="text-left">Fail</th> <td class="text-right" ng-repeat="c in grade.table[4] track by $index">{{c | number: 0}}%</td> </tr> </table> </div> <div layout-padding ng-if="grade.students.fields.indexOf(\'name\') < 0" class="msg-warn"> Warning: It is recommanded to have a name column. </div> <table> <thead> <tr> <th></th> <th ng-repeat="col in grade.students.fields track by $index"> <div layout="row" layout-align="start end"> <span>{{col}}</span> <md-button class="button-remove" aria-label="rename column" ng-click="grade.renameColumn($event, grade.students.fields, $index, grade.students.data)" ng-hide="col == \'id\'"><md-icon class="mdi-pencil"></md-icon></md-button> <md-button aria-label="remove column" ng-click="grade.removeCol(col)" class="md-warn button-remove" ng-hide="col == \'id\'"><md-icon class="mdi-close"></md-icon></md-button> </div> </th> <th class="text-left"> <md-input-container class="md-block no-error-input-container" style="width:185px;"> <label>Final grade formula</label> <input ng-blur="app.api.saveOptions()" ng-model="app.api.options.options.final_grade_formula" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }"> </md-input-container> </th> <th class="text-left grade-max"> <md-input-container class="md-block no-error-input-container"> <label>Points</label> <input string-to-number class="text-right" ng-blur="app.api.saveOptions()" ng-model="app.api.options.options.points_max" ng-change="grade.dataTable({variable: app.api.options.options.points_max, formula: grade.test})" min="0" type="number"> </md-input-container> </th> <th>Total<br> <span class="question-max">(max:{{grade.maxPoints}})</span> <md-button ng-class="{\'md-raised\': grade.displayQuestions}" ng-click="grade.displayQuestions = !grade.displayQuestions">show all</md-button> </th> <th class="score" ng-if="grade.displayQuestions" ng-repeat="(qtitle, value) in grade.questions track by $index"> {{qtitle}}<br><span class="question-max">(max:{{value.max}})</span></th> </tr> </thead> <tbody> <tr ng-repeat="u in grade.unmatched track by $index"> <td colspan="{{grade.students.fields.length + 1}}"><md-button class="md-primary" aria-label="manual association" ng-click="grade.showAssociationDialog($event, u)">manual match</md-button></td> <td></td> <td class="text-right grade">{{grade.grade(grade.unmatched[u.key].total, app.api.options.options.points_max, app.api.options.options.note_min, app.api.options.options.note_max, \'round\', app.api.options.options.note_grain) | number: 2}}</td> <td class="text-right">{{grade.unmatched[u.key].total}}</td> <td class="text-right score why-{{grade.whys[grade.unmatched[u.key].key + \':\' + value.question]}}" ng-repeat="(qtitle, value) in grade.questions track by $index"> <a ng-href="#!/{{grade.project}}/scan/{{grade.unmatched[u.key].student}}/{{value.page}}:{{grade.unmatched[u.key].copy}}"> {{grade.unmatched[u.key].questions[qtitle]}}</a></td> </tr> <tr ng-repeat="s in grade.students.data track by $index"> <td class="no-wrap"> <md-button title="remove student" aria-label="remove student" ng-click="grade.removeStudent(s)" class="md-warn button-remove"><md-icon class="mdi-close"></md-icon></md-button> <md-button title="unmatch student" ng-if="grade.scores[s.id]" aria-label="unmatch student" ng-click="grade.unmatchStudent(s)" class="md-accent button-remove"><md-icon class="mdi-link-off"></md-icon></md-button> <md-button title="view annotated copy" ng-if="grade.scores[s.id]" aria-label="view annotated" ng-click="grade.annotateScore(grade.scores[s.id])" class="md-accent button-remove"><md-icon class="mdi-eye"></md-icon></md-button> </td> <td ng-class="{\'text-right\': col==\'id\'}" ng-repeat="col in grade.students.fields track by $index" ng-click="grade.editCell($event, s, col)">{{s[col]}}</td> <td class="text-right grade" ng-class="{\'grade-fail\': s.FinalGrade < 3.5, \'grade-pass\': s.FinalGrade >= 4, \'grade-remed\': s.FinalGrade >=3.5 && s.FinalGrade < 4}">{{grade.calculate(s, \'FinalGrade\', app.api.options.options.final_grade_formula)}}</td> <td class="text-right grade" ng-class="{\'grade-fail\': s.Grade < 3.5, \'grade-pass\': s.Grade >= 4, \'grade-remed\': s.Grade >=3.5 && s.Grade < 4}">{{grade.scores[s.id].hasOwnProperty(\'total\') ? grade.valueSaver(s, \'Grade\', grade.grade(grade.scores[s.id].total,app.api.options.options.points_max, app.api.options.options.note_min, app.api.options.options.note_max, \'round\', app.api.options.options.note_grain)) : 0}}</td> <td class="text-right">{{grade.valueSaver(s, \'Total\', grade.scores[s.id].total)}}</td> <td ng-if="grade.displayQuestions" class="text-right score why-{{grade.whys[grade.scores[s.id].key + \':\' + value.question]}}" ng-repeat="(qtitle, value) in grade.questions track by $index"> <a ng-href="#!/{{grade.project}}/scan/{{grade.scores[s.id].student}}/{{value.page}}:{{grade.scores[s.id].copy}}"> {{grade.scores[s.id].questions[qtitle]}}</a></td> </tr> </tbody> <tfoot> <tr> <th><md-button class="md-raised md-warn" ng-click="grade.annotateAll()">Annotate All</md-button></th> <th ng-class="{\'text-right\': col==\'id\'}" ng-repeat="col in grade.students.fields track by $index"> {{col==\'id\' ? grade.students.data.length : (grade.avgTotalStudent(col) | number: 2)}} </th> <th class="text-right">{{grade.avgTotalStudent(\'FinalGrade\') | number: 2}}</th> <th class="text-right">{{grade.avgTotalStudent(\'Grade\') | number: 2}}</th> <th class="text-right">{{grade.avgTotal()}}</th> <th ng-if="grade.displayQuestions" class="text-right score" ng-repeat="(qtitle, value) in grade.questions track by $index"> {{grade.avgQuestion(qtitle) / value.max * 100 | number: 0}}%</th> </tr> </tfoot> </table> <div class="legend"> <p><span class="why-E">E</span> means syntax error (several boxes ticked for a simple question, or " none of the above" AND another box ticked for a multiple question).</p> <p><span class="why-V">V</span> means that no box are ticked.</p> <p><span class="why-P">P</span> means that a floor has been applied.</p> </div> </section> </md-tab> <md-tab label="Stats"> <div class="section-options md-whiteframe-z1" layout="row"> <md-button aria-label="sort title" class="md-primary" ng-click="grade.statsOrder=\'title\'">order by question</md-button> <md-button aria-label="sort mean" class="md-primary" ng-click="grade.statsOrder=\'avg\'">order by mean</md-button> <md-button aria-label="catalog" class="md-primary" ng-href="{{app.linkTo(\'catalog.pdf\')}}">Download Catalog.pdf</md-button> </div> <div ng-if="grade.tabIndex == 1" layout="row" layout-wrap> <div class="question-stat" ng-repeat="q in grade.stats| orderBy:grade.statsOrder"> <h2 ng-bind="q.title"></h2> <div><b>total:</b> {{q.total}} <b>mean:</b> {{(q.avg*100).toFixed(2)}}%</div> <div class="answer-dist"> <div ng-repeat="a in q.answers" ng-style="{width: a.nb/q.total*100 +\'%\'}" class="answer-stat correct-{{a.correct}}" layout="row"><span flex>{{a.answer}} {{a.nb}}</span><span>{{(a.nb/q.total*100).toFixed(2)}}%</span></div> </div> </div> </div> </md-tab> <md-tab label="{{file.name.substring(0,20)}}" ng-repeat="file in grade.files"> <md-content ng-if="grade.tabIndex == $index + 2"> <div class="section-options no-error-input-container" layout-padding> <div layout="row" layout-sm="column"> <md-input-container flex> <label>StudentLookup</label> <input ng-model="file.studentLookup" ng-model-options="{ updateOn: \'blur\' }" ng-blur="grade.save()"> </md-input-container> <md-input-container> <label>test student id</label> <input ng-model="file.demoid" ng-blur="grade.save()"> </md-input-container> <p>{{grade.demoStudent(file)}}</p> </div> <div layout="row" layout-sm="column"> <md-input-container flex> <label>CurrentFileLookup</label> <input ng-model="file.fileLookup" ng-model-options="{ updateOn: \'blur\' }" ng-blur="grade.save()"> </md-input-container> <md-button class="md-warn" ng-click="grade.import(file)">import selected columns</md-button> </div> </div> <table> <thead> <tr> <th class="no-wrap">Student Match</th> <th class="no-wrap">Lookup Value</th> <th ng-repeat="key in file.meta.fields track by $index"> <div layout="row" class="no-wrap"> <md-checkbox class="md-primary" ng-model="file.meta.selected[$index]" ng-change="grade.save()">{{key}}</md-checkbox> <md-button class="button-remove" aria-label="rename column" ng-click="grade.renameColumn($event, file.meta.fields, $index, file.data)"><md-icon class="mdi-pencil"></md-icon></md-button> <md-button aria-label="remove column" ng-click="file.meta.fields.splice($index, 1);grade.save();" class="md-warn button-remove" ng-hide="col == \'id\'"><md-icon class="mdi-close"></md-icon></md-button> </div> </th> </tr> </thead> <tbody> <tr ng-repeat="row in file.data"> <td> {{ grade.lookup(row, file.fileLookup, file.studentLookup).join(\', \') }} </td> <td> {{ grade.makeFunc(file.fileLookup)(row) }} </td> <td ng-repeat="key in file.meta.fields track by $index">{{row[key]}}</td> </tr> </tbody> </table> <md-button class="md-raised md-warn" ng-click="grade.removeFile(file)">Remove file</md-button> </md-content> </md-tab> </md-tabs> </div>'),e.put("views/graphicsmanager.html",'<md-dialog aria-label="Graphics Manager" class="graphics-manager"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Graphics Manager</h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <md-button ngf-drop ngf-select ng-model="ctrl.files" class="md-raised md-accent drop-box" ngf-drag-over-class="dragover" ngf-multiple="true" ngf-allow-dir="true"> Drop pdfs or images here or click to upload</md-button> <div ngf-no-file-drop>File Drag/Drop is not supported for this browser</div> <md-input-container class="md-block"> <label>Search</label> <input ng-model="ctrl.search"> </md-input-container> <div class="thumb-container" layout="row" layout-wrap ngf-drop ng-model="ctrl.files" ngf-drag-over-class="dragover" ngf-multiple="true" ngf-allow-dir="true"> <div class="graphics-preview" ng-click="ctrl.insertGraphics(item)" ng-style="{\'background-image\': ctrl.progress[item.id].progress < 100 ? \'none\' : \'url(\' + ctrl.examService.graphicsPreviewURL(item.id) + \')\'}" ng-repeat="item in ctrl.graphics | filter: {\'name\': ctrl.search} track by $index"> <div class="graphics-preview-header" layout="row" layout-align="center center"> <h3 flex>{{item.name}}</h3> <md-button ng-hide="ctrl.progress[item.id].progress < 100" class="md-icon-button md-warn" ng-click="ctrl.deleteGraphics(item); $event.stopPropagation();"> <md-icon class="mdi-delete" aria-label="delete graphics"></md-icon> </md-button> </div> <div ng-show="ctrl.progress[item.id].progress < 100"> <h4>Uploading</h4> <md-progress-linear md-mode="determinate" value="{{ctrl.progress[item.id].progress}}"></md-progress-linear> </div> </div> </div> </md-dialog-content> <md-dialog-actions layout="row"> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </md-dialog-actions> </md-dialog>'),e.put("views/history.html",'<div flex class="scroll-frame"> <md-content layout="column" class="no-background scroll-section options" layout-padding> <h2>History</h2> <div class="commit {{c.type}}" ng-repeat="c in ctrl.logs"> <span>{{c.msg}} by {{c.username}} @ {{c.date | date:\'dd/MM/yyyy HH:mm\'}}</span> <md-button ng-show="c.type == \'commit\'" class="md-warn" ng-click="ctrl.restore($event, c)">Restore</md-button> </div> </md-content> </div> '),e.put("views/home.html",'<md-content layout-padding class="no-background" layout-align="start center" layout="column" flex> <form ng-hide="home.isAuthed()" ng-submit="home.login()"> <md-card> <md-card-content> <md-input-container class="md-block"> <label>Username</label> <input ng-model="home.username" ng-required="true"> </md-input-container> <md-input-container class="md-block"> <label>Password</label> <input ng-model="home.password" type="password" ng-required="true"> </md-input-container> <ng-messages for="home.error" role="alert" class="md-block"> <ng-message when="error">{{home.error.error}}</ng-message> </ng-messages> </md-card-content> <md-card-actions layout="row" layout-align="end center"> <md-button type="submit" class="md-primary">Login</md-button> <md-button type="submit">Create</md-button> </md-card-actions> </md-card> </form> <div ng-show="home.isAuthed()" class="projects"> <md-card> <md-card-title> <md-card-title-text> <span class="md-headline">New Project</span> </md-card-title-text> </md-card-title> <md-card-content> <form name="newprojectform" ng-submit="home.createProject()" layout="row" layout-align="center center"> <div> <md-input-container class="md-block" style="margin-bottom: 0;"> <label>Project name</label> <input ng-model="home.newProjectName" name="name" ng-required="true" ng-pattern="/^[-0-9a-z\\_]+$/"> </md-input-container> <ng-messages for="home.error" role="alert" class="md-block"> <ng-message when="error">{{home.error.error}}</ng-message> </ng-messages> <ng-messages for="newprojectform.$error" role="alert" class="md-block"> <ng-message when="pattern">Only the following characters are allowed: 0-9a-z-_</ng-message> </ng-messages> </div> <md-button ng-disabled="newprojectform.name.$error.pattern" class="md-primary md-raised" type="submit">Create Project</md-button> </form> </md-card-content> </md-card> <md-card> <md-card-title> <md-card-title-text> <span class="md-headline">Existing Projects</span> </md-card-title-text> </md-card-title> <md-card-content> <md-input-container class="md-block"> <label>Search</label> <input ng-model="home.search"> </md-input-container> <md-tabs md-dynamic-height md-border-bottom md-selected="home.selectedTab"> <md-tab label="Recent"> <md-content> <table ng-show="home.API.projects.length > 0"> <thead> <tr> <th colspan="2" class="text-left">Name</th> <th>Status</th> <th>Collaborators</th> <th class="text-right">Action</th> </tr> </thead> <tbody> <tr class="project" ng-repeat="item in home.API.projectsRecent" ng-click="home.openProject(item)"> <td> <md-checkbox aria-label="{{item.project}}"></md-checkbox> </td> <td><b>{{item.project}}</b></td> <td> <span ng-show="item.status.printed && !item.status.annotated">printed</span> <span ng-show="item.status.annotated">annotated</span> </td> <td>{{item.users | join: \', \'}}</td> <td class="text-right"> <md-button ng-click="home.openProject(item);$event.stopPropagation();" title="open" class="md-primary md-icon-button" aria-label="copy project"> <md-icon class="mdi-eye"></md-icon> </md-button> <md-button ng-click="home.copyProject($event, item);$event.stopPropagation();" title="copy" class="md-primary md-icon-button" aria-label="copy project"> <md-icon class="mdi-content-copy"></md-icon> </md-button> </td> </tr> </tbody> </table> </md-content> </md-tab> <md-tab label="All"> <md-content> <table ng-show="home.API.projects.length > 0"> <thead> <tr> <th colspan="2" class="text-left">Name</th> <th>Status</th> <th>Collaborators</th> <th class="text-right">Action</th> </tr> </thead> <tbody> <tr class="subheader" ng-show="item.short != (home.API.projects | filter: {\'project\': home.search})[$index-1].short" ng-repeat-start="item in home.API.projects | filter: {\'project\': home.search}"> <td colspan="5" class="md-whiteframe-1dp">{{item.short}}</td> </tr> <tr class="project" ng-repeat-end ng-click="home.openProject(item)"> <td> <md-checkbox aria-label="{{item.project}}"></md-checkbox> </td> <td><b>{{item.project}}</b></td> <td> <span ng-show="item.status.printed && !item.status.annotated">printed</span> <span ng-show="item.status.annotated">annotated</span> </td> <td>{{item.users | join: \', \'}}</td> <td class="text-right"> <md-button ng-click="home.openProject(item);$event.stopPropagation();" title="open" class="md-primary md-icon-button" aria-label="copy project"> <md-icon class="mdi-eye"></md-icon> </md-button> <md-button ng-click="home.copyProject($event, item);$event.stopPropagation();" title="copy" class="md-primary md-icon-button" aria-label="copy project"> <md-icon class="mdi-content-copy"></md-icon> </md-button> </td> </tr> </tbody> </table> </md-content> </md-tab> </md-tabs> <md-list ng-hide="home.API.projects.length > 0"> <md-list-item>No projects found!</md-list-item> </md-list> </md-card-content> </md-card> </div> <a ng-href="https://github.com/bfritscher/grademanager/commit/{{home.version}}" class="git-version">v: {{home.version}} </a></md-content>'),e.put("views/myrichtexteditor.html",'<div class="myrichtexteditor" layout-padding> <div class="toolbar md-whiteframe-z1 hide" layout="row" layout-align="start center"> <a data-wysihtml5-command="bold" title="CTRL+B"><md-icon class="mdi-format-bold"></md-icon></a> <a data-wysihtml5-command="italic" title="CTRL+I"><md-icon class="mdi-format-italic"></md-icon></a> <a data-wysihtml5-command="formatInline" title="Monospace CTRL+M" data-wysihtml5-command-value="tt"><md-icon class="mdi-format-text"></md-icon></a> <a data-wysihtml5-command="formatInline" title="Latex Source not escaped CTRL+L" data-wysihtml5-command-value="var">LaTeX</a> <a ng-mousedown="$event.preventDefault();ctrl.showStyle=!ctrl.showStyle" href="javascript:;"><md-icon class="mdi-format-size"></md-icon></a> <div class="md-whiteframe-z2 toolbar-menu" ng-if="ctrl.showStyle" layout="column"> <a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" title="p" ng-click="$event.stopPropagation();cmd(\'formatBlock\', \'p\');ctrl.showStyle=false"><md-icon class="mdi-format-paragraph"></md-icon></a> <a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" title="h1" ng-click="$event.stopPropagation();cmd(\'formatBlock\', \'h1\');ctrl.showStyle=false"><md-icon class="mdi-format-header-1"></md-icon></a> <a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" title="h2" ng-click="$event.stopPropagation();cmd(\'formatBlock\', \'h2\');ctrl.showStyle=false"><md-icon class="mdi-format-header-2"></md-icon></a> <a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" title="h3" ng-click="$event.stopPropagation();cmd(\'formatBlock\', \'h3\');ctrl.showStyle=false"><md-icon class="mdi-format-header-3"></md-icon></a> </div> <a data-wysihtml5-command="insertUnorderedList"><md-icon class="mdi-format-list-bulleted"></md-icon></a> <a data-wysihtml5-command="insertOrderedList"><md-icon class="mdi-format-list-numbers"></md-icon></a> <a data-wysihtml5-command="justifyCenter"><md-icon class="mdi-format-align-center"></md-icon></a> <a ng-mousedown="$event.preventDefault();showGraphicsManager($event)" href="javascript:;"><md-icon class="mdi-image"></md-icon></a> <a data-wysihtml5-command="insertCode" data-wysihtml5-command-value=\'<div class="code"></div>\'><md-icon class="mdi-file-xml"></md-icon></a> <a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="box" title="frame box"><md-icon class="mdi-checkbox-blank-outline"></md-icon></a> <a data-wysihtml5-action="change_view" title="toggle html source">switch view</a> <span flex></span> <a ng-mousedown="$event.preventDefault();close();" href="javascript:;" title="close edit"><md-icon class="mdi-close"></md-icon></a> </div> <textarea ng-model="content" ng-model-options="{ updateOn: \'blur\'}" class="hide"></textarea> <div class="preview"></div> <div class="graphics-toolbar hide" layout="row" ng-mousedown="$event.preventDefault()" layout-align="center center"> <md-checkbox class="md-primary" ng-mousedown="$event.preventDefault();" ng-model="graphics.border">Border</md-checkbox> <div ng-show="!graphics.options" layout="row" layout-align="center center"> <md-button aria-label="narrower" class="md-icon-button" ng-mousedown="$event.preventDefault();graphics.width=graphics.width-0.1"><md-icon class="mdi-minus"></md-icon></md-button> <p>{{graphics.width*100|number:0}}%</p> <md-button aria-label="wider" class="md-icon-button" ng-mousedown="$event.preventDefault();graphics.width=graphics.width+0.1"><md-icon class="mdi-plus"></md-icon></md-button> </div> <div class="options" ng-show="graphics.options" ng-mousedown="$event.preventDefault();showGraphicsSettings($event, graphics)"> {{graphics.options}} </div> <md-button aria-label="options" class="md-icon-button" ng-mousedown="$event.preventDefault();showGraphicsSettings($event, graphics)"><md-icon class="mdi-settings"></md-icon></md-button> <span flex></span> <md-button aria-label="close" class="md-icon-button" ng-mousedown="$event.preventDefault();closeGraphicsToolbar()"><md-icon class="mdi-close"></md-icon></md-button> </div> </div>'),e.put("views/options.html",'<div flex class="scroll-frame"> <md-content layout="column" class="no-background scroll-section options" layout-padding> <h2>Collaborators</h2> <md-chips ng-model="ctrl.options.users" placeholder="add another username" secondary-placeholder="+username"></md-chips> <h2>Raw exports</h2> <p> <md-button class="md-raised md-primary" ng-href="{{ctrl.downloadURL}}">Download <small>project.zip</small></md-button> <md-button class="md-raised md-primary" ng-href="{{ctrl.downloadODSURL}}">Download <small>export.ods</small> </md-button> <md-button class="md-raised md-primary" ng-href="{{ctrl.downloadCSVURL}}">Download <small>students.csv</small></md-button> </p> <h2>Options</h2> <p> <md-button class="md-warn md-raised" ng-click="ctrl.saveOptions()">Save Options</md-button> </p> <h3>Print</h3> <md-input-container> <label>Nb of copies</label> <input ng-model="ctrl.options.options.nombre_copies" string-to-number type="number" ng-blur="ctrl.saveOptions()"> </md-input-container> <p> <md-checkbox ng-change="ctrl.saveOptions()" class="md-primary" ng-model="ctrl.options.options.split" ng-true-value="\'1\'" ng-false-value="\'0\'">Print answersheet in separate file.</md-checkbox> </p> <h3>Scan</h3> <p> Threshold: {{ctrl.options.options.seuil * 100 | number: 0}}% black filled <md-slider ng-change="ctrl.saveOptions()" class="md-primary" md-discrete string-to-number ng-model="ctrl.options.options.seuil" min="0" max="1" step="0.05" aria-label="threshold"></md-slider> When one uses a separate answer sheet, letters or digits use at least 0.5. </p> <p> <b>Type of scans</b> <md-select ng-disabled="true" class="md-primary" placeholder="Type of scans" ng-model="ctrl.options.options.auto_capture_mode"> <md-option value="0">Different answer sheets</md-option> <md-option value="1">Some answer sheets were photocopied</md-option> </md-select> </p> <h3>Annotation</h3> <md-input-container class="md-block no-error-input-container"> <label>Annotation filename pattern</label> <input ng-model="ctrl.options.options.modele_regroupement" ng-blur="ctrl.saveOptions()"> </md-input-container> <p>(ID) is replaced by the student\'s name.<br> (N) is replaced by the student number.<br> (<i>COLNAME</i>) any other column name in the student.csv</p> <div> Click to add: <md-chips md-on-select="ctrl.addColToFilename($chip)" md-removable="false" ng-model="ctrl.fields"></md-chips></div> <md-input-container class="no-padding md-block no-error-input-container" style="margin-top: 3em;"> <label>Annotation</label> <textarea ng-model="ctrl.options.options.verdict" ng-blur="ctrl.saveOptions()"></textarea> </md-input-container> <p> %(ID) is replaced by the student\'s name.<br> %(COLNAME) is replaced by the value of column COLNAME in the students list for the current student.<br> %S is replaced by the student\'s total score.<br> %M is replaced by the maximum total score.<br> %s is replaced by the student\'s mark.<br> %m is replaced by the maximum mark.</p> <div> Click to add: <md-chips md-on-select="ctrl.addColToAnnotation($chip)" md-removable="false" ng-model="ctrl.fields"></md-chips></div> <h4>Annotation marks</h4> <table> <tr> <th>Preview</th> <th>To be ticked</th> <th>Ticked</th> <th>Type</th> <th>Color</th> </tr> <tr> <td><md-icon ng-style="{color: ctrl.options.options.symbole_0_0_color}" ng-class="{\'mdi-close\': ctrl.options.options.symbole_0_0_type == \'mark\', \'mdi-checkbox-blank-outline\': ctrl.options.options.symbole_0_0_type == \'box\', \'mdi-checkbox-blank-circle-outline\': ctrl.options.options.symbole_0_0_type == \'circle\'}"></md-icon></td> <td>no</td> <td>no</td> <td> <md-select ng-change="ctrl.saveOptions()" class="md-primary" placeholder="type" ng-model="ctrl.options.options.symbole_0_0_type"> <md-option ng-repeat="value in ::ctrl.types" value="{{value}}">{{value}}</md-option> </md-select> </td> <td><span class="color" ng-click="ctrl.options.options.symbole_0_0_color = color;ctrl.saveOptions()" ng-repeat="color in ::ctrl.colors" ng-style="{\'background-color\': color}" ng-class="{\'selected\': ctrl.options.options.symbole_0_0_color == color}"></span></td> </tr> <tr> <td><md-icon ng-style="{color: ctrl.options.options.symbole_0_1_color}" ng-class="{\'mdi-close\': ctrl.options.options.symbole_0_1_type == \'mark\', \'mdi-checkbox-blank-outline\': ctrl.options.options.symbole_0_1_type == \'box\', \'mdi-checkbox-blank-circle-outline\': ctrl.options.options.symbole_0_1_type == \'circle\'}"></md-icon></td> <td>no</td> <td>yes</td> <td> <md-select ng-change="ctrl.saveOptions()" class="md-primary" placeholder="type" ng-model="ctrl.options.options.symbole_0_1_type"> <md-option ng-repeat="value in ::ctrl.types" value="{{value}}">{{value}}</md-option> </md-select> </td> <td><span class="color" ng-click="ctrl.options.options.symbole_0_1_color = color;ctrl.saveOptions()" ng-repeat="color in ::ctrl.colors" ng-style="{\'background-color\': color}" ng-class="{\'selected\': ctrl.options.options.symbole_0_1_color == color}"></span></td> </tr> <tr> <td><md-icon ng-style="{color: ctrl.options.options.symbole_1_0_color}" ng-class="{\'mdi-close\': ctrl.options.options.symbole_1_0_type == \'mark\', \'mdi-checkbox-blank-outline\': ctrl.options.options.symbole_1_0_type == \'box\', \'mdi-checkbox-blank-circle-outline\': ctrl.options.options.symbole_1_0_type == \'circle\'}"></md-icon></td> <td>yes</td> <td>no</td> <td> <md-select ng-change="ctrl.saveOptions()" class="md-primary" placeholder="type" ng-model="ctrl.options.options.symbole_1_0_type"> <md-option ng-repeat="value in ::ctrl.types" value="{{value}}">{{value}}</md-option> </md-select> </td> <td><span class="color" ng-click="ctrl.options.options.symbole_1_0_color = color;ctrl.saveOptions()" ng-repeat="color in ::ctrl.colors" ng-style="{\'background-color\': color}" ng-class="{\'selected\': ctrl.options.options.symbole_1_0_color == color}"></span></td> </tr> <tr> <td><md-icon ng-style="{color: ctrl.options.options.symbole_1_1_color}" ng-class="{\'mdi-close\': ctrl.options.options.symbole_1_1_type == \'mark\', \'mdi-checkbox-blank-outline\': ctrl.options.options.symbole_1_1_type == \'box\', \'mdi-checkbox-blank-circle-outline\': ctrl.options.options.symbole_1_1_type == \'circle\'}"></md-icon></td> <td>yes</td> <td>yes</td> <td> <md-select ng-change="ctrl.saveOptions()" class="md-primary" placeholder="type" ng-model="ctrl.options.options.symbole_1_1_type"> <md-option ng-repeat="value in ::ctrl.types" value="{{value}}">{{value}}</md-option> </md-select> </td> <td><span class="color" ng-click="ctrl.options.options.symbole_1_1_color = color;ctrl.saveOptions()" ng-repeat="color in ::ctrl.colors" ng-style="{\'background-color\': color}" ng-class="{\'selected\': ctrl.options.options.symbole_1_1_color == color}"></span></td> </tr> </table> <md-switch ng-model="showAllOptions" aria-label="show all options"> Display all options </md-switch> <div ng-if="showAllOptions"> <md-input-container ng-repeat="(key, value) in ctrl.options.options" class="md-block"> <label>{{::key}}</label> <input ng-model="ctrl.options.options[key]" ng-if="::key !=\'verdict\' && key != \'email_text\'"> <textarea ng-model="ctrl.options.options[key]" ng-if="::key ==\'verdict\' || key ==\'email_text\'"></textarea> </md-input-container> </div> <p> <md-button class="md-warn md-raised" ng-click="ctrl.saveOptions()">Save Options</md-button> </p> <h2>Danger</h2> <p> <md-button class="md-raised md-accent" ng-href="{{ctrl.scoringURL}}">Scoring <small>(force redo)</small></md-button> <md-button class="md-raised md-accent" ng-href="{{ctrl.markURL}}">Marking <small>(force redo)</small></md-button> <md-button class="md-raised md-warn" ng-href="{{ctrl.resetLockURL}}">Reset <small>project\'s server locks</small></md-button> <md-button class="md-raised md-accent" ng-href="" ng-click="ctrl.renameProject()">Rename project</md-button> <md-button class="md-raised md-warn" ng-href="" ng-click="ctrl.deleteProject()">Delete project!</md-button> </p> </md-content> </div> '),e.put("views/profile.html",'<md-content layout-padding class="no-background" layout-align="start center" layout="column" flex> <form ng-submit="profile.changePassword()"> <md-card> <md-card-content> <h2>Password Manager</h2> <md-input-container> <label>Old Password</label> <input ng-model="profile.oldPassword" type="password" ng-required="true"> </md-input-container> <md-input-container> <label>New Password</label> <input ng-model="profile.password" type="password" ng-required="true"> </md-input-container> <md-input-container> <label>New Password (repeat)</label> <input ng-model="profile.password2" type="password" match="profile.password" ng-required="true"> </md-input-container> <ng-messages for="profile.error" role="alert"> <ng-message when="error">{{profile.error.error}}</ng-message> </ng-messages> </md-card-content> <md-card-actions layout="row" layout-align="end center"> <md-button class="md-primary" type="submit" ng-disabled="profile.password != profile.password2">Change Password</md-button> </md-card-actions> </md-card> </form> <md-card> <md-card-content> <h2>2-Factor Authentication</h2> <md-input-container> <label>Password</label> <input ng-model="profile.u2fPassword" type="password" ng-required="true"> </md-input-container> <md-button class="md-raised md-primary" ng-disabled="app.getUser().u2f" ng-click="profile.addU2f()">Add u2f Key</md-button> <md-button class="md-raised md-warn" ng-disabled="!app.getUser().u2f" ng-click="profile.removeU2f()">Remove u2f Key</md-button> <div> <ng-messages for="profile.u2ferror" role="alert"> <ng-message when="error">{{profile.u2ferror.error}}</ng-message> </ng-messages> </div> </md-card-content> </md-card> </md-content>'),e.put("views/progressdialog.html",'<md-dialog aria-label="Task Progress" class="progress-dialog" flex="60"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Task Progress</h2> </div> </md-toolbar> <md-dialog-content md-scroll-y> <div layout="row" layout-align="center center"> <md-button class="md-raised md-primary" ng-if="ctrl.api.options.status.printed && ctrl.api.logs[\'printing done\']" ng-href="{{ctrl.api.getDownloadZipURL()}}">Download Zip with all PDFs</md-button> <md-button class="md-raised md-primary" ng-if="ctrl.api.options.status.annotated && ctrl.api.logs[\'annotating done\'] && ctrl.api.logs[\'annotating done\'].type==\'all\'" ng-href="{{ctrl.api.getAnnotateZipURL()}}">Download Zip with all annotated PDFs</md-button> <md-button class="md-raised md-primary" ng-if="ctrl.api.options.status.annotated && ctrl.api.logs[\'annotating done\'] && ctrl.api.logs[\'annotating done\'].type==\'single\'" ng-href="{{ctrl.api.getStaticFileURL(ctrl.api.logs[\'annotating done\'].file)}}">Download {{ctrl.api.logs[\'annotating done\'].file}}</md-button> </div> <div ng-repeat="log in ctrl.api.sortedLogs" class="log" ng-class="{\'error\': log.code > 0}"> <h4>{{log.msg}}</h4> <md-progress-linear ng-class="{\'md-warn\': log.code > 0}" md-mode="determinate" value="{{log.progress * 100}}"></md-progress-linear> <p>{{log.start| date: \'HH:mm:ss\'}} <span ng-if="log.end">: {{(log.end.getTime() - log.start.getTime())/1000 | number: 0}}s</span></p> <pre ng-if="log.command != \'prepare\'">{{log.log}}</pre> <pre ng-if="log.command != \'prepare\' && log.code > 0">{{log.err}}</pre> </div> </md-dialog-content> <md-dialog-actions layout="row"> <span flex></span> <md-button ng-disabled="ctrl.api.options.status.locked!=0" ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </md-dialog-actions> </md-dialog> '),e.put("views/promptdialog.html",'<md-dialog aria-label="prompt" class="prompt-dialog"> <md-toolbar> <div class="md-toolbar-tools"> <h2 ng-bind="ctrl.options.title"></h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <p>{{ctrl.options.content}}</p> <md-input-container class="md-block"> <label>{{ctrl.options.label}}</label> <input ng-model="ctrl.options.value"> </md-input-container> </md-dialog-content> <md-dialog-actions layout="row"> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> Cancel </md-button> <md-button ng-click="ctrl.saveDialog()" class="md-primary"> Save </md-button> </md-dialog-actions> </md-dialog> '),e.put("views/propertiesmanager.html",'<md-dialog aria-label="Document Properties Manager" id="properties-manager"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Document Properties Manager</h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div ng-repeat="key in ctrl.getProperties()" layout="row"> <md-input-container class="md-block" flex> <label>{{key}}</label> <input ng-model="ctrl.examService.exam.properties[key]"> </md-input-container> <md-button class="md-icon-button md-warn" aria-label="delete" ng-click="ctrl.removeProperty(key)"> <md-icon class="mdi-delete"></md-icon> </md-button> </div> </md-dialog-content> <md-dialog-actions layout="row"> <span flex>Display any <tt>\\AMC<i>property_name</i></tt> from source.tex</span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </md-dialog-actions> </md-dialog>'),e.put("views/scan.html",'<div ng-if="app.api.options.options.auto_capture_mode != 0 && app.api.options.options.auto_capture_mode != 1" class="printed-bar" layout-padding layout="row" layout-align="center center"> You have to choose the type of scans you use for this project: <md-select class="md-primary" placeholder="Type of scans" ng-model="scan.auto_capture_mode"> <md-option value="0">Different answer sheets</md-option> <md-option value="1">Some answer sheets were photocopied</md-option> </md-select> <md-button class="md-raised md-primary" ng-click="app.api.options.options.auto_capture_mode = scan.auto_capture_mode; app.api.saveOptions(app.api.options.options)">Save</md-button> <span flex></span> </div> <div ng-if="app.api.options.options.auto_capture_mode != -1" layout="row" flex> <div class="scan-pages" layout="column"> <div layout-padding class="scan-options no-error-input-container"> <h4>Upload papers</h4> <p><md-button ngf-drop ngf-select ng-model="scan.files" class="md-raised md-accent drop-box" ngf-drag-over-class="dragover"> Drop files here or click to upload</md-button> </p><div ngf-no-file-drop>File Drag/Drop is not supported for this browser</div> <p></p> <md-content class="upload-list"> <p ng-repeat="f in scan.uploads track by $index">{{::f.name}} <md-progress-linear md-mode="determinate" value="{{f.progress}}"></md-progress-linear> </p> </md-content> <h4>Scanned papers</h4> <p>Complete: {{scan.missing.complete}} <span ng-show="scan.missing.incomplete > 0">Incomplete: {{scan.missing.incomplete}}</span></p> <div ng-show="scan.missing.missing.length > 0"> Missing pages: <md-content class="scan-missing-list"> <div ng-repeat="missing in scan.missing.missing track by $index">{{::missing.student}}/{{::missing.page}}<span ng-show="missing.copy > 0">:{{::missing.copy}}</span></div> </md-content> </div> <div ng-show="scan.missing.failed.length > 0"> Failed pages: <md-content class="scan-missing-list"> <div ng-repeat="failed in scan.missing.failed track by $index">{{::failed.filename}}</div> </md-content> </div> <md-input-container md-no-float> <md-icon class="mdi-magnify"></md-icon> <input ng-model="scan.filter" type="text" placeholder="Filter"> </md-input-container> </div> <md-content flex layout-padding md-scroll-y> <table> <thead> <tr> <th ng-class="{\'sort-asc\': scan.orderBy == \'id\' && !scan.reverse, \'sort-desc\': scan.orderBy == \'id\' && scan.reverse}" ng-click="scan.sort(\'id\')">Identifier <md-icon class="mdi-help-circle"> <md-tooltip>Student/Page/Copy green=auto blue=manual</md-tooltip></md-icon> </th> <th hide-xs ng-class="{\'sort-asc\': scan.orderBy == \'timestamp_auto\' && !scan.reverse, \'sort-desc\': scan.orderBy == \'timestamp_auto\' && scan.reverse}" ng-click="scan.sort(\'timestamp_auto\')">Updated</th> <th ng-class="{\'sort-asc\': scan.orderBy == \'mse\' && !scan.reverse, \'sort-desc\': scan.orderBy == \'mse\' && scan.reverse}" ng-click="scan.sort(\'mse\')">MSD <md-icon class="mdi-help-circle"> <md-tooltip>The value MSD (mean square deviation) is an indication of the good framing of the marks (the four black dots surrounding each copy). When it is too great, the framing must be checked.</md-tooltip></md-icon> </th> <th ng-class="{\'sort-asc\': scan.orderBy == \'s\' && !scan.reverse, \'sort-desc\': scan.orderBy == \'s\' && scan.reverse}" ng-click="scan.sort(\'s\')">Sensitivity <md-icon class="mdi-help-circle"> <md-tooltip>The value sensitivity is an indicator of proximity of the filling of the boxes with the threshold. If it is too great (from 8 to its max value 10), we must check whether the boxes recognized as checked are the good ones.</md-tooltip></md-icon> </th> </tr> </thead> <tbody> <tr ng-repeat="p in scan.pages | filter:{id:scan.filter} | orderBy: (scan.reverse?\'-\':\'\') + scan.orderBy" ng-click="scan.loadPage(p)" ng-class="{active: scan.page.student == p.student && scan.page.page == p.page && scan.page.copy == p.copy}"> <td ng-class="::{\'manual\': p.timestamp_manual > 0, \'auto\': p.timestamp_auto > 0}">{{::p.student}}/{{::p.page}}<span ng-show="::p.copy > 0">:{{::p.copy}}</span> <md-icon class="mdi-close scan-delete" ng-click="scan.delete(p)"></md-icon></td> <td hide-xs>{{::(p.timestamp_manual || p.timestamp_auto)*1000 | date:\'yyyy-MM-dd HH:mm\'}}</td> <td class="text-right" ng-class="::{\'s-threshold\': p.mse >=3}">{{::p.tm > 0 && \'(\' || \'\'}}{{::p.mse.toFixed(1)}}{{::p.tm > 0 && \')\' || \'\'}}</td> <td class="text-right" ng-class="::{\'s-threshold\': p.s >= 8}">{{::p.s.toFixed(1)}}</td> </tr> </tbody> <tfoot> <td colspan="4"> <md-button ng-hide="scan.pages.length == 0" class="md-warn md-raised" ng-click="scan.deleteAll()">delete all scans</md-button> <md-progress-linear ng-hide="scan.pages.length > 0" md-mode="indeterminate"></md-progress-linear> </td> </tfoot> </table> </md-content> </div> <div ng-if="$mdMedia(\'gt-sm\')" ui-view="" class="scan-preview" flex layout="column" layout-padding hide-xs> <div flex layout="column" layout-align="center center"> <h1>No page selected for preview</h1> </div> </div> <md-sidenav ng-if="$mdMedia(\'sm\')" class="md-sidenav-right" md-component-id="right" layout="column" layout-padding> <div ui-view="" class="scan-preview" flex layout="column" layout-padding> <div flex layout="column" layout-align="center center"> <h1>No page selected for preview</h1> </div> </div> </md-sidenav> </div>'),e.put("views/scan.preview.html",'<div style="position:relative" flex layout="row"> <md-button class="md-warn md-raised scan-reset" ng-click="preview.clear()"><md-tooltip>Remove manually set ticks</md-tooltip>remove manual</md-button> <md-checkbox class="md-primary scan-rotate" ng-model="preview.rotate">rotate</md-checkbox> <svg ng-if="preview.page" pan-zoom version="1.1" flex xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <image xlink:href="" ng-xlink:href="{{preview.pageSrc()}}" x="0" y="0" ng-attr-width="{{preview.page.width}}px" ng-attr-height="{{preview.page.height}}px" style="transform: {{preview.rotate ? \'matrix(\' + preview.page.a + \',\' + preview.page.b + \',\' + preview.page.c + \',\' + preview.page.d + \',\' + preview.page.e + \',\' + preview.page.f + \')\' : \'matrix(1,0,0,1,0,0)\'}}"></image> <g ng-attr-transform="{{ preview.rotate ? \'matrix(\' + preview.page.a + \',\' + preview.page.b + \',\' + preview.page.c + \',\' + preview.page.d + \',\' + preview.page.e + \',\' + preview.page.f + \')\' : \'\'}}"> <path ng-repeat="z in preview.zones" ng-attr-d="M {{z.x0}} {{z.y0}} L {{z.x1}} {{z.y1}} L {{z.x2}} {{z.y2}} L {{z.x3}} {{z.y3}} Z" ng-click="preview.toggle(z)" ng-attr-stroke="{{preview.ticked(z) && \'red\' || \'blue\'}}" fill="transparent" stroke-width="4" ng-attr-stroke-dasharray="{{z.manual > -1 && \'6,3\' || \'0\'}}"/> </g> </svg> </div>')}]);